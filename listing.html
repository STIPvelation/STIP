<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- 주석: 추가된 WAI-ARIA 관련 메타 태그 -->
  <meta name="application-name" content="STIP IP Exchange Official Website">
  <meta name="author" content="STIP">
  <meta name="description" content="Intellectual property trading platform">
  <!-- 검색엔진 최적화를 위한 추가 메타 태그 -->
  <meta name="keywords"
    content="Intellectual Property Trading Platform, Buy and Sell Patents, Trademark Exchange, Global IP Marketplace, IP Licensing">
  <meta property="og:title" content="STIP IP Exchange Official Website">
  <meta property="og:description" content="Intellectual property trading platform">  
  <meta name="subject" content="STIP IP Exchange Official Website">
  <meta name="copyright" content="Copyright (c) STIP. All rights reserved.">
  <meta name="publisher" content="STIP">
  <meta name="category" content="STIP IP Exchange Official Website">
  <meta name="coverage" content="Worldwide">
  <meta name="distribution" content="Global">
  <meta name="rating" content="General">
  <meta name="revisit-after" content="7 days">

  <!-- Open Graph 추가 태그 -->
  <meta property="og:type" content="business.business">
  <meta property="og:url" content="https://stipvelation.com/">
  <meta property="og:image" content="https://stipvelation.com/assets/images/images/p002.jpg">
  <meta property="og:site_name" content="STIP IP Exchange Official Website">
  <meta property="business:contact_data:street_address" content="서울시 강남구 테헤란로151 1116호">
  <meta property="business:contact_data:country_name" content="Korea">

  <!-- 소셜 미디어 최적화를 위한 추가 태그 -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="STIP IP Exchange Official Website">
  <meta name="twitter:description" content="Intellectual property trading platform">
  <meta name="twitter:image" content="https://stipvelation.com/assets/images/twitter-image.jpg">

  <!-- 추가 검색엔진 최적화 태그 -->
  <link rel="canonical" href="https://stipvelation.com/">
  <meta name="google-site-verification" content="google-site-verification=GOZJABKmCzKGcPRTvfWr85NEmZ0f0jmJooxEk6PhvGM">
  <meta name="naver-site-verification" content="3d9f84392f2f8c5adb989466c29ed24f43b23232"">
      
  <!-- 메타 태그 추가 끝 -->
  <meta name=" robots" content="index, follow">

  <!-- <title>STIP HomePage stipvelation</title> -->
  <title>STIP IP Exchange Official Website</title>
  <link rel="apple-touch-icon" sizes="57x57" href="favicon.ico2/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="favicon.ico2/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="favicon.ico2/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="favicon.ico2/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="favicon.ico2/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="favicon.ico2/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="favicon.ico2/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="favicon.ico2/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon.ico2/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="favicon.ico2/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.ico2/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="favicon.ico2/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon.ico2/favicon-16x16.png">
  <link rel="manifest" href="favicon.ico2/manifest.json">

  <link rel="stylesheet" href="assets/style/components/header.css" />
  <link rel="stylesheet" href="assets/style/pages/listing.css" />
  <link rel="stylesheet" href="assets/style/reset.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/gh/sun-typeface/SUIT@2/fonts/static/woff2/SUIT.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  <!-- <script src="https://cdn.jsdelivr.net/npm/TagCloud@2.5.0/dist/TagCloud.min.js"></script> -->
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

  <!-- <script src="https://pg-web.nicepay.co.kr/v3/common/js/nicepay-pgweb.js"></script> -->

  <!-- <script type="module" src="listing.js"></script>
  <script type="module" src="currency.js"></script>
  <script type="module" src="language.js"></script>
  <script type="module" src="error_messages.js"></script>
  <script type="module" src="product_preview_form.js"></script>
  <script type="module" src="order_form.js"></script>
  <script type="module" src="contact_form.js"></script> -->

  <script type="module" src="error_messages.js"></script>

  <!-- listing.html -->
  <!-- 서비스 스크립트 -->
  <!-- <script src="js/services/currency-service.js"></script> -->
  <script src="js/services/language-service.js"></script>
  <script src="js/services/device-service.js"></script>
  <!-- <script src="js/services/currency-service.js"></script> -->
  <!-- <script src="js/services/country-service.js"></script> -->
  <!-- <script src="js/services/file-upload-service.js"></script> -->
  <!-- <script src="js/services/payment-service.js"></script> -->
  <!-- <script src="js/services/swiper-service.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/TagCloud@2.5.0/dist/TagCloud.min.js"></script>
  <script src="js/services/tag-cloud-service.js"></script>


  <!-- 결제 관련 스크립트 -->
  <!-- 기존 스크립트들 아래에 추가 -->
  <!-- <script src="js/services/payment-validator.js"></script> -->
  <!-- <script src="js/services/session-manager.js"></script> -->
  <!-- <script src="js/services/exchange-rate-service.js"></script> -->

  <!-- 서비스 스크립트 -->
  <script src="js/services/currency-service.js"></script>
  <script src="js/services/exchange-rate-service.js"></script>
  <!-- <script src="js/services/payment-service.js"></script> -->
  <script src="js/services/session-manager.js"></script>

  <!-- 폼 처리 스크립트 -->
  <script src="js/form-handler.js"></script>

  <!-- <script src="js/config.js"></script> -->
  <!-- <script src="js/currency-converter2.js"></script> -->
  <!-- <script src="js/payment-handler3.js"></script> -->
  <style>
    body {
      font-family: "SUIT", sans-serif;
    }

    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .loading-overlay.active {
      display: flex;
    }

    /* toast.css */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
    }

    .toast {
      padding: 12px 24px;
      margin-bottom: 10px;
      border-radius: 4px;
      background: #333;
      color: white;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    .toast-info {
      background: #3498db;
    }

    .toast-error {
      background: #e74c3c;
    }

    .toast-success {
      background: #2ecc71;
    }

    .product-section {
      display: flex;
      flex-direction: column;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      /* gap: 12px; */
      /* width: 50%; */
      box-sizing: content-box;
    }

    .product-image {
      width: 240px;
      height: 240px;
      border-radius: 8px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.1);
    }

    .product-ex {
      flex: 1 100px;
      padding: 14px 4px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      /* box-sizing: border-box; */
    }

    .product-image:hover {
      cursor: pointer;
      border: 1px solid #007bff;
    }

    #previewProductEx {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      color: #fcfcfc;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      transition: all 0.3s ease;
      overflow-y: scroll;
    }

    #previewProductEx:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
    }

    #previewProductCode {
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="root">
    <header class="header-container">
      <div class="header-wrapper">
        <div class="header-logo">
          <a href="index.html">
            <img src="assets/images/logo.svg" alt="logo" />
          </a>
        </div>
        <nav class="header-nav">
          <div class="burger-menu-wrapper">
            <img src="assets/images/mobile/menu.svg" class="burger-menu" alt="burger-menu" onclick="handleBurgerMenu()">
            <div class="side-bar-container">
              <div class="sidebar-background">
                <div class="close-btn">
                  <img src="assets/images/mobile/close.svg" alt="close" onclick="handleBurgerMenuClose()">
                </div>
              </div>
              <div class="side-bar-wrapper">
                <nav class="side-bar-section">
                  <div class="side-bar-list">
                    <a class="side-bar-item navigate" href="index.html" data-page="main"
                      onclick="handlePageSelection('main')">main</a>
                    <a class="side-bar-item navigate active" href="listing.html" data-page="listing"
                      onclick="handlePageSelection('listing')">Listing</a>
                    <a class="side-bar-item navigate" href="about.html" data-page="about"
                      onclick="handlePageSelection('about')">About us</a>
                    <a class="side-bar-item navigate" href="product.html" data-page="product"
                      onclick="handlePageSelection('product')">Product</a>
                    <a class="side-bar-item navigate" href="contact.html" data-page="contact"
                      onclick="handlePageSelection('contact')">Contact</a>
                  </div>
                  <div class="side-bar-list lang">
                    <span class="side-bar-item" onclick="handleLangChange('ko', true)">한국어</span>
                    <span class="side-bar-item" onclick="handleLangChange('en', true)">English</span>
                    <span class="side-bar-item" onclick="handleLangChange('ja', true)">日本語</span>
                    <span class="side-bar-item" onclick="handleLangChange('zh', true)">中文</span>
                  </div>
                </nav>
              </div>
            </div>
          </div>
          <ul>
            <li><a class="nav-item navigate active" href="listing.html" data-page="listing"
                onclick="handlePageSelection('listing')">Listing</a></li>
            <li><a class="nav-item navigate" href="about.html" data-page="about"
                onclick="handlePageSelection('about')">About us</a></li>
            <li><a class="nav-item navigate" href="product.html" data-page="product"
                onclick="handlePageSelection('product')">Product</a></li>
            <li><a class="nav-item navigate" href="contact.html" data-page="contact"
                onclick="handlePageSelection('contact')">Contact</a></li>
            <div class="dropdown">
              <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                data-bs-toggle="dropdown" aria-expanded="false">
                한국어
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                <li>
                  <div class="dropdown-item" onclick="handleLangChange('ko')">한국어</div>
                </li>
                <li>
                  <div class="dropdown-item" onclick="handleLangChange('en')">English</div>
                </li>
                <li>
                  <div class="dropdown-item" onclick="handleLangChange('ja')">日本語</div>
                </li>
                <li>
                  <div class="dropdown-item" onclick="handleLangChange('zh')">中文</div>
                </li>
              </ul>
            </div>
          </ul>
        </nav>
      </div>
    </header>

    <!-- </html> -->
    <!-- header end -->
    <div class="bg-image">
      <img src="assets/images/bg-image.jpg" alt="bg-image" />
    </div>
    <div class="bg-mobile-image">
      <img src="assets/images/light-bg-image.png" alt="bg-mobile-image" />
    </div>
    <main class="content-container">
      <div class="content-wrapper" style="z-index: 9;">
        <div class="title-area">
          <h1 class="letter-title" style="margin-top: 16rem;">
            <span> Listing </span>
          </h1>
          <p><span>S</span>hare your wisdom with the world</p>
          <p><span>T</span>he seeds of progress begin with you</p>
        </div>
        <div class="row-area">
          <div class="radius-box column">
            <!-- 상품 미리보기 폼 시작 -->
            <form id="productPreviewForm" class="product-preview-form" style="display: none;">
              <!-- <input type="hidden" id="previewProductCode" name="productCode" value="0001" /> -->
              <!-- <input type="hidden" id="previewProductName" name="productName" value="특허뉴스PDF" /> -->
              <!-- <input type="hidden" id="previewQuantity" name="quantity" value="1" /> -->
              <!-- <input type="hidden" id="previewPrice" name="price" value="₩99,000"/> -->
              <!--<h2 class="form-title" data-lang-ko="상품 정보" data-lang-en="Product Information" data-lang-ja="商品情報"
                data-lang-zh="产品信息"></h2>-->
              <h2 class="form-title" data-lang-ko="상품 정보" data-lang-en="Product Information" data-lang-ja="商品情報"
                data-lang-zh="产品信息"></h2>
              <div class="product-info-section">
                <div class="product-section">
                  <div class="product-image">
                    <img src="assets/images/p001.jpg" alt="특허뉴스PDF" />
                  </div>
                  <div class="product-ex">
                    <textarea name="previewProductEx" id="previewProductEx"></textarea>
                    <!-- <p name="prueviewProductEx" id="prueviewProductEx"></p> -->
                  </div>
                </div>
                <div class="product-details">
                  <div class="input-group">
                    <label for="previewProductCode" class="required">
                      <span data-lang-ko="상품코드" data-lang-en="Product Code" data-lang-ja="商品コード"
                        data-lang-zh="产品代码"></span>
                      <span class="sr-only">(Required)</span>
                    </label>
                    <input type="text" name="productCode" id="previewProductCode" value="0001" readonly />
                  </div>
                  <div class="input-group">
                    <label for="previewProductName" class="required">
                      <span data-lang-ko="상품명" data-lang-en="Product Name" data-lang-ja="商品名"
                        data-lang-zh="产品名称"></span>
                      <span class="sr-only">(Required)</span>
                    </label>
                    <input type="text" name="productName" id="previewProductName" readonly />
                  </div>
                  <div class="input-group">
                    <label for="previewQuantity" class="required">
                      <span data-lang-ko="수량" data-lang-en="Quantity" data-lang-ja="数量" data-lang-zh="数量"></span>
                      <span class="sr-only">(Required)</span>
                    </label>
                    <input type="number" name="quantity" id="previewQuantity" value="1" readonly />
                  </div>
                  <div class="input-group">
                    <label for="previewPrice" class="required">
                      <span data-lang-ko="가격" data-lang-en="Price" data-lang-ja="価格" data-lang-zh="价格"></span>
                      <span class="sr-only">(Required)</span>
                    </label>
                    <div class="price-input-wrapper">
                      <input type="text" name="displayPrice" id="previewPrice" data-currency="KRW"
                        data-currency-symbol="₩" readonly />
                      <input type="hidden" id="prewiew_hidden_price" name="price" value="99000" data-currency="KRW" />
                    </div>
                  </div>
                </div>
              </div>
              <button type="submit" class="normal-button" data-lang-ko="확인" data-lang-en="Confirm" data-lang-ja="確認"
                data-lang-zh="确认">확인</button>
            </form>
            <!-- 상품 미리보기 폼 끝 -->
            <!-- Order Form -->
            <!-- 주문 폼  -->
            <form id="orderForm" class="order-form" style="display: block;">
              <input type="hidden" id="hidden_orderProductCode" name="productCode" value="0001" />
              <input type="hidden" id="hidden_orderProductName" name="productName" value="특허뉴스PDF" />
              <input type="hidden" id="hidden_orderQuantity" name="quantity" value="1" />
              <input type="hidden" id="hidden_orderPrice" name="price" value="99000.00" />
              <!-- 주문자 정보 -->
              <div class="order-detail-section">
                <div class="input-box">
                  <!-- <h3 class="form-subtitle" data-lang-ko="주문자 정보" data-lang-en="Order Information" data-lang-ja="注文者情報" -->
                    data-lang-zh="订购人信息"></h3>
                  <div class="order-info">
                    <!-- <div class="input-box">
                      <label for="orderName" class="required">
                        <span data-lang-ko="이름" data-lang-en="Name" data-lang-ja="名前" data-lang-zh="姓名"></span>
                        <span class="sr-only" data-lang-ko="(필수)" data-lang-en="(Required)" data-lang-ja="(必須)"
                          data-lang-zh="(必填)"></span>
                      </label>
                      <input type="text" id="orderName" name="orderName" required
                        data-lang-ko-placeholder="주문자 이름을 입력하세요" data-lang-en-placeholder="Enter your name"
                        data-lang-ja-placeholder="注文者名を入力してください" data-lang-zh-placeholder="请输入订购人姓名" />
                    </div> -->
                    <!-- <div class="input-box">
                      <label for="orderPhone" class="required">
                        <span data-lang-ko="연락처" data-lang-en="Phone" data-lang-ja="連絡先" data-lang-zh="联系电话"></span>
                        <span class="sr-only" data-lang-ko="(필수)" data-lang-en="(Required)" data-lang-ja="(必須)"
                          data-lang-zh="(必填)"></span>
                      </label>
                      <input type="tel" id="orderPhone" name="orderPhone" required data-lang-ko-placeholder="연락처를 입력하세요"
                        data-lang-en-placeholder="Enter your phone number" data-lang-ja-placeholder="連絡先を入力してください"
                        data-lang-zh-placeholder="请输入联系电话" />
                    </div> -->
                    <!-- <div class="input-box">
                      <label for="orderEmail" class="required">
                        <span data-lang-ko="이메일" data-lang-en="Email" data-lang-ja="メール" data-lang-zh="电子邮箱"></span>
                        <span class="sr-only" data-lang-ko="(필수)" data-lang-en="(Required)" data-lang-ja="(必須)"
                          data-lang-zh="(必填)"></span>
                      </label>
                      <input type="email" id="orderEmail" name="orderEmail" required
                        data-lang-ko-placeholder="이메일을 입력하세요" data-lang-en-placeholder="Enter your email"
                        data-lang-ja-placeholder="メールアドレスを入力してください" data-lang-zh-placeholder="请输入电子邮箱" />
                    </div> -->
                    <!-- <div class="input-box mb-3">
                      <span style="color: #fcfcfc;" data-lang-ko="기타메모" data-lang-en="Additional Notes"
                        data-lang-ja="備考" data-lang-zh="备注"></span>
                      </label>
                      <textarea id="orderMemo" name="orderMemo" rows="3"
                        data-lang-ko-placeholder="배송 시 요청사항이나 기타 메모를 입력하세요"
                        data-lang-en-placeholder="Enter delivery requests or additional notes"
                        data-lang-ja-placeholder="配送時のご要望やその他メモを入力してください"
                        data-lang-zh-placeholder="请输入配送要求或其他备注"></textarea>
                    </div> -->
                  </div>
                </div>

                <!-- 상품 정보 -->
                <div class="input-box mb-3">
                  <h3 class="form-subtitle" data-lang-ko="상품정보" data-lang-en="Product Information" data-lang-ja="商品情報"
                    data-lang-zh="产品信息"></h3>
                  <div class="product-info">
                    <div class="product-image">
                      <img src="assets/images/p001.jpg" alt="특허뉴스PDF" class="product-thumb" />
                    </div>
                    <div class="product-details">
                      <p class="product-code"><span data-lang-ko="상품코드:" data-lang-en="Product Code:"
                          data-lang-ja="商品コード:" data-lang-zh="商品代码:"></span> 0001</p>
                      <p class="product-name"><span data-lang-ko="상품명:" data-lang-en="Product Name:" data-lang-ja="商品名:"
                          data-lang-zh="商品名称:"></span> 특허뉴스PDF</p>
                      <p class="product-quantity"><span data-lang-ko="수량:" data-lang-en="Quantity:" data-lang-ja="数量:"
                          data-lang-zh="数量:"></span> 1개</p>
                    </div>
                  </div>
                </div>

                <!-- 결제 금액 -->
                <div class="input-box mb-3">
                  <!-- <h3 class="form-subtitle">결제 금액</h3> -->
                  <h3 class="form-subtitle" data-lang-ko="결제금액" data-lang-en="Payment Amount" data-lang-ja="決済金額"
                    data-lang-zh="支付金额">
                  </h3>
                  <div class="payment-details">
                    <div class="price-row">
                      <!-- <span>상품가격</span> -->
                      <span data-lang-ko="상품가격" data-lang-en="Product Price" data-lang-ja="商品価格"
                        data-lang-zh="产品价格"></span>
                      <span class="amount"></span>
                      <!-- <span class="amount">99,000 KRW</span> -->
                    </div>
                    <div class="price-row discount">
                      <span data-lang-ko="할인금액" data-lang-en="Discount Amount" data-lang-ja="割引金額"
                        data-lang-zh="折扣金额"></span>
                      <span class="amount">(-) 0 KRW</span>
                    </div>
                    <div class="price-row total">
                      <span data-lang-ko="총 결제금액" data-lang-en="Total Payment Amount" data-lang-ja="総支払金額"
                        data-lang-zh="总支付金额"></span>
                      <span class="amount">99,000 KRW</span>
                    </div>
                  </div>
                </div>

                <!-- 개인정보 수집 동의 -->
                <div class="input-box mb-3">
                  <!-- <h3 class="form-subtitle">개인정보 수집 및 이용 동의</h3> -->
                  <h3 class="form-subtitle" data-lang-ko="개인정보 수집 및 이용 동의" data-lang-en="Privacy Policy Agreement"
                    data-lang-ja="個人情報の収集及び利用同意" data-lang-zh="个人信息收集及使用同意"></h3>
                  <div class="privacy-consent">
                    <!-- <textarea readonly class="privacy-text">
                        1. 개인정보의 수집 및 이용목적
                        - 서비스 제공 및 계약의 이행
                        - 상품 배송 및 대금 결제
                        
                        2. 수집하는 개인정보 항목
                        - 이름, 연락처, 이메일 주소
                        
                        3. 개인정보의 보유 및 이용기간
                        - 법령에 따른 보존기간까지
                              </textarea> -->
                    <textarea readonly class="privacy-text"
                      data-lang-ko="1. 개인정보의 수집 및 이용목적 - 서비스 제공 및 계약의 이행 - 상품 배송 및 대금 결제 2. 수집하는 개인정보 항목 - 이름, 연락처, 이메일 주소 3. 개인정보의 보유 및 이용기간 - 법령에 따른 보존기간까지"
                      data-lang-en="1. Purpose of collecting and using personal information - Providing services and fulfilling contracts - Product delivery and payment processing 2. Types of personal information collected - Name, Contact number, Email address 3. Retention and usage period of personal information - Until the preservation period required by law"
                      data-lang-ja="1. 個人情報の収集及び利用目的 - サービス提供及び契約の履行 - 商品配送及び代金決済 2. 収集する個人情報項目 - 氏名、連絡先、メールアドレス 3. 個人情報の保有及び利用期間 - 法令に基づく保存期間まで"
                      data-lang-zh="1. 个人信息收集及使用目的 - 提供服务及履行合同 - 商品配送及支付处理 2. 收集的个人信息项目 - 姓名、联系方式、电子邮箱 3. 个人信息的保留及使用期限 - 按照法律规定的保存期限"></textarea>
                    <div class="consent-check">
                      <input type="checkbox" id="privacyConsent" name="privacyConsent" checked />
                      <!-- <label for="privacyConsent">개인정보 수집 및 이용에 동의합니다 (필수)</label> -->
                      <label for="privacyConsent" data-lang-ko="개인정보 수집 및 이용에 동의합니다 (필수)"
                        data-lang-en="I agree to the collection and use of personal information (Required)"
                        data-lang-ja="個人情報の収集及び利用に同意します（必須）" data-lang-zh="我同意收集和使用个人信息（必填）">
                        개인정보 수집 및 이용에 동의합니다 (필수)
                      </label>
                    </div>
                  </div>
                </div>

                <!-- 결제수단 선택 -->
                <div class="input-box mb-3">
                  <!-- <h3 class="form-subtitle">결제수단 선택</h3> -->
                  <h3 class="form-subtitle" data-lang-ko="결제수단 선택" data-lang-en="Select Payment Method"
                    data-lang-ja="決済手段選択" data-lang-zh="选择支付方式"></h3>
                  <div class="payment-method">
                    <div class="method-option">
                      <input type="checkbox" id="creditCard" name="paymentMethod" checked />
                      <!-- <label for="creditCard" class="disabled">신용카드</label> -->
                      <label for="creditCard" class="disabled" data-lang-ko="신용카드" data-lang-en="Credit Card"
                        data-lang-ja="クレジットカード" data-lang-zh="信用卡">
                        신용카드
                      </label>
                    </div>
                  </div>
                </div>

                <!-- 결제하기 버튼 -->
                <div class="input-box button">
                  <!-- <button type="submit" class="normal-button">결제하기</button> -->
                  <button type="submit" class="normal-button" data-lang-ko="결제하기" data-lang-en="Proceed to Payment"
                    data-lang-ja="決済する" data-lang-zh="付款">
                    결제하기
                  </button>
                </div>
              </div>
            </form>
            <!-- orderForm 끝 -->

            <!-- contactForm 시작 -->
            <form id="contactForm" aria-labelledby="formTitle" style="display: none;">
              <!-- Hidden fields for product information -->
              <input type="hidden" id="productCode" name="productCode" value="0001">
              <input type="hidden" id="productName" name="productName" value="특허뉴스PDF">

              <div class="input-box mb-3">
                <label for="country" class="required form-label" aria-required="true">
                  <span class="label-text" data-lang-ko="국가" data-lang-en="Country" data-lang-ja="国家"
                    data-lang-zh="国家"></span>
                  <span class="sr-only" data-lang-ko="(필수)" data-lang-en="(Required)" data-lang-ja="(必須)"
                    data-lang-zh="(必填)"></span>
                </label>
                <select class="form-select" id="country" name="country" required>
                  <option value="" selected disabled data-lang-ko="국가를 선택하세요" data-lang-en="Select a country"
                    data-lang-ja="国を選択してください" data-lang-zh="请选择国家">Select a country</option>
                </select>
              </div>

              <div class="input-box">
                <label for="name" class="required" aria-required="true">
                  Name
                  <span class="sr-only">(Required)</span>
                </label>
                <input type="text" id="name" name="name" placeholder="Please enter your name." required
                  autocomplete="name" />
              </div>

              <div class="input-box">
                <label for="email" class="required" aria-required="true">
                  Email
                  <span class="sr-only">(Required)</span>
                </label>
                <input type="text" id="email" name="email" placeholder="Please enter your email." required
                  autocomplete="email" />
              </div>

              <div class="input-box">
                <label for="mobile" class="required" aria-required="true">
                  Mobile
                  <span class="sr-only">(Required)</span>
                </label>
                <input type="text" id="mobile" name="mobile" placeholder="Please enter your contact information."
                  required autocomplete="mobile" />
              </div>

              <div class="input-box">
                <label id="fileUploadLabel" for="uploadfile" class="required" aria-required="true">
                  <span class="label-text" data-lang-ko="파일 업로드" data-lang-en="File Upload" data-lang-ja="ファイルアップロード"
                    data-lang-zh="文件上传"></span>
                </label>
                <div class="file-upload-container">
                  <div class="file-upload-area" role="region" aria-labelledby="fileUploadLabel" id="dropZone">
                    <label for="file" class="file-upload-button">
                      <span class="plus-icon">+</span>
                    </label>
                    <input type="file" id="file" name="file" accept=".pdf,.doc,.docx" multiple
                      aria-describedby="fileHelpText" aria-label="Select File" style="display: none;">
                    <div id="fileHelpText" class="file-help-text"
                      data-lang-ko="허용된 파일 형식: PDF, DOC, DOCX. 최대 파일 크기: 5MB"
                      data-lang-en="Allowed file types: PDF, DOC, DOCX. Maximum file size: 5MB"
                      data-lang-ja="許可されているファイル形式：PDF、DOC、DOCX。最大ファイルサイズ：5MB"
                      data-lang-zh="允许的文件类型：PDF、DOC、DOCX。最大文件大小：5MB">
                    </div>
                  </div>
                  <div id="fileList" class="file-list"></div>
                  <div id="errorMessage" class="error-message" role="alert" aria-live="polite"></div>
                </div>
              </div>

              <div class="input-box button">
                <label for="submit" class="required">
                  <a href="https://smart.kipa.org" class="link-text" target="_blank" rel="noopener noreferrer"
                    aria-label="SMART5 특허 평가 보고서 제출 페이지로 이동">
                    SMART5
                  </a>
                  특허 평가 보고서를 제출하세요
                </label>
                <!--<a href="https://smart.kipa.org" class="link-text" target="_blank" rel="noopener noreferrer"
                  aria-label="SMART5 특허 평가 보고서 제출 페이지로 이동">
                  SMART5
                </a>
                <span class="submit-text">특허 평가 보고서를 제출하세요</span>-->
                <button id="submit" name="submit" class="normal-button">Submit</button>
              </div>
            </form>
            <style>
              .product-preview-form {
                width: 100%;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 8px;
                padding: 32px 10px;
                margin-bottom: 24px;
                color: #fcfcfc;
              }

              .product-preview-form h2.form-title {
                font-size: 1.5rem;
                font-weight: bold;
                color: #fcfcfc;
                margin-bottom: 24px;
              }

              .required:after {
                content: '*';
                color: #ff4444;
                margin-left: 4px;
              }

              .price-input-wrapper {
                position: relative;
                display: flex;
                align-items: center;
              }

              /* previewPrice 입력 필드 값 오른쪽 정렬 */
              .price-input-wrapper input[type="text"] {
                text-align: right;
                /* 텍스트를 오른쪽으로 정렬 */
                width: 100%;
                /* 입력 필드가 부모 요소를 가득 채우도록 설정 */
                box-sizing: border-box;
                /* 패딩과 테두리를 포함한 크기 계산 */
                padding: 8px;
                /* 입력 필드 안쪽 여백 */
                font-size: 16px;
                /* 텍스트 크기 설정 */
                border: 1px solid #ccc;
                /* 입력 필드 테두리 */
                border-radius: 4px;
                /* 둥근 모서리 */
                background-color: #f9f9f9;
                /* 읽기 전용 배경색 */
                color: #fcfcfc;
                /* 텍스트 색상 */
              }

              .price-input-wrapper .currency {
                position: absolute;
                right: 12px;
                color: #fcfcfc;
                font-size: 14px;
                pointer-events: none;
              }

              .multi-currency {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-top: 8px;
              }

              /* .currency {
                font-size: 14px;
                color: #fcfcfc;
                padding: 4px 8px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 4px;
              } */

              /* .currency.krw {
                background: rgba(0, 123, 255, 0.1);
              }

              .currency.usd {
                background: rgba(40, 167, 69, 0.1);
              }

              .currency.jpy {
                background: rgba(220, 53, 69, 0.1);
              }

              .currency.cny {
                background: rgba(255, 193, 7, 0.1);
              } */

              .currency-display {
                margin-top: 8px;
              }

              .currency {
                display: none;
                /* 기본적으로 모든 통화 숨김 */
                font-size: 14px;
                color: #fcfcfc;
                padding: 4px 8px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 4px;
              }

              /* 언어별 스타일 */
              .ko-price {
                background: rgba(0, 123, 255, 0.1);
              }

              .en-price {
                background: rgba(40, 167, 69, 0.1);
              }

              .ja-price {
                background: rgba(220, 53, 69, 0.1);
              }

              .zh-price {
                background: rgba(255, 193, 7, 0.1);
              }

              .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                border: 0;
              }

              .product-info-section {
                display: flex;
                gap: 32px;
                margin-bottom: 24px;
              }

              .product-image {
                width: 240px;
                height: 240px;
                border-radius: 8px;
                overflow: hidden;
                background: rgba(255, 255, 255, 0.1);
              }

              .product-image img {
                width: 100%;
                height: 100%;
                object-fit: cover;
              }

              .product-details {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 16px;
              }

              .input-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
              }

              .input-group label {
                font-size: 14px;
                font-weight: 500;
                color: #fcfcfc;
              }

              .input-group input {
                width: 100%;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 4px;
                padding: 12px;
                color: #fcfcfc;
                font-size: 16px;
                transition: border-color 0.3s ease;
              }

              .input-group input:read-only {
                background: rgba(255, 255, 255, 0.05);
                cursor: not-allowed;
                opacity: 0.8;
                color: #fcfcfc;
              }

              .input-group .currency {
                position: relative;
                display: inline-flex;
                align-items: center;
              }

              .input-group .currency:after {
                content: 'KRW';
                position: absolute;
                right: 12px;
                top: 50%;
                transform: translateY(-50%);
                color: #fcfcfc;
                font-size: 14px;
              }

              .product-preview-form .normal-button {
                width: 100%;
                /* background: var(--primary-color, #4CAF50); */
                background-color: rgba(0, 0, 0, 0.3);
                color: #fcfcfc;
                /* border: none; */
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 4px;
                padding: 14px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                transition: background-color 0.3s ease;
                backdrop-filter: blur(5px);
              }

              .product-preview-form .normal-button:hover {
                /* background: var(--primary-color-dark, #388E3C); */
                background-color: rgba(0, 0, 0, 0.5);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
              }

              .product-preview-form .normal-button:active {
                transform: translateY(1px);
              }

              /* 호버 효과 */
              .input-group input:hover:not(:read-only) {
                border-color: rgba(255, 255, 255, 0.3);
              }

              /* 포커스 효과 */
              .input-group input:focus:not(:read-only) {
                border-color: var(--primary-color, #4CAF50);
                outline: none;
                box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
              }

              /* 반응형 디자인 */
              @media (max-width: 768px) {
                .product-preview-form {
                  padding: 20px;
                }

                .product-info-section {
                  flex-direction: column;
                  /* gap: 24px; */
                }

                .product-image {
                  width: 100%;
                  /* height: auto; */
                  /* aspect-ratio: 1; */
                  /* max-width: 320px; */
                  max-width: 300px;
                  margin: 0 auto;
                }

                .product-details {
                  gap: 12px;
                }

                .input-group input {
                  font-size: 14px;
                  padding: 10px;
                  color: #fcfcfc;
                }
              }

              /* 다크 모드 지원 */
              @media (prefers-color-scheme: dark) {
                .product-preview-form {
                  background: rgba(255, 255, 255, 0.07);
                  color: #fcfcfc;
                }

                .input-group input {
                  background: rgba(255, 255, 255, 0.08);
                  color: #fcfcfc;
                }

                .input-group input:read-only {
                  background: rgba(255, 255, 255, 0.04);
                  color: #fcfcfc;
                }
              }

              /* 애니메이션 효과 */
              .product-preview-form {
                animation: fadeIn 0.3s ease-out;
              }

              @keyframes fadeIn {
                from {
                  opacity: 0;
                  transform: translateY(10px);
                }

                to {
                  opacity: 1;
                  transform: translateY(0);
                }
              }

              /* 접근성 개선 */
              .product-preview-form :focus {
                outline: 2px solid var(--primary-color, #4CAF50);
                outline-offset: 2px;
              }

              .product-preview-form :focus:not(:focus-visible) {
                outline: none;
              }

              .product-preview-form :focus-visible {
                outline: 2px solid var(--primary-color, #4CAF50);
                outline-offset: 2px;
              }

              #contactForm {
                width: 100%;
              }

              #contactForm .input-box {
                margin: 5px 0;
              }

              /* 링크 스타일 개선 */
              #contactForm .link-text {
                text-decoration: none;
                position: relative;
                color: inherit;
                /* 부모 요소의 색상 상속 */
                transition: color 0.3s ease;
                /* 색상 변화에 대한 트랜지션 추가 */
              }

              #contactForm .link-text:hover {
                cursor: pointer;
              }

              /* 밑줄 애니메이션 효과 */
              #contactForm .link-text::after {
                content: '';
                position: absolute;
                bottom: -2px;
                left: 0;
                width: 0;
                height: 2px;
                background-color: var(--orange-color);
                transition: width 0.3s ease;
                transform-origin: left;
                /* 왼쪽에서 시작하는 애니메이션 */
              }

              #contactForm .link-text:hover::after {
                width: 100%;
              }

              /* 접근성을 위한 포커스 스타일 */
              #contactForm .link-text:focus {
                outline: none;
              }

              #contactForm .link-text:focus::after {
                width: 100%;
              }

              .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                border: 0;
              }

              .normal-button {
                background-color: rgba(0, 0, 0, 0.3);
                /* 투명한 검정색 배경 */
                border: 1px solid rgba(255, 255, 255, 0.3);
                /* 반투명한 흰색 테두리 */
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 1rem;
                transition: all 0.3s ease;
                backdrop-filter: blur(5px);
                /* 배경 블러 효과 */
                margin-top: 20px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                min-width: 120px;
              }

              .normal-button:hover {
                background-color: rgba(0, 0, 0, 0.5);
                /* 호버시 더 진한 배경 */
                border-color: rgba(255, 255, 255, 0.5);
                /* 호버시 더 진한 테두리 */
                transform: translateY(-2px);
                /* 살짝 위로 움직이는 효과 */
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                /* 그림자 효과 */
              }

              .normal-button:active {
                transform: translateY(0);
                /* 클릭시 원래 위치로 */
              }

              .normal-button:focus {
                outline: none;
                box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2);
              }

              .normal-button span {
                color: white;
                font-weight: 500;
              }

              /* 반응형 */
              @media (max-width: 768px) {
                .normal-button {
                  padding: 10px 20px;
                  font-size: 0.95rem;
                  min-width: 100px;
                }
              }

              @media (max-width: 480px) {
                .normal-button {
                  padding: 8px 16px;
                  font-size: 0.9rem;
                  min-width: 90px;
                }
              }
            </style>
            <div class="input-box button" style="display: none;">
              <label for="pay" class="required" aria-required="true">
                Payment
                <span class="sr-only">(Required)</span>
              </label>
              <button id="pay" name="pay" class="normal-button" style="display: none;">Payment</button>
            </div>

            <!-- 결제 폼 대신 주문 폼으로 교체 -->

            <!-- </div> -->
            <!-- </div> -->
            <!-- 주문 완료 팝업 -->
            <div id="orderCompletePopup" class="modal-overlay" style="display: none;">
              <div class="modal-content">
                <div class="complete-popup">
                  <!-- 체크마크 아이콘 -->
                  <div class="complete-icon">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                      <path d="M8 12L11 15L16 9" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                    </svg>
                  </div>

                  <!-- 완료 메시지 -->
                  <h2 class="complete-title" data-lang-ko="주문이 완료되었습니다" data-lang-en="Order Completed"
                    data-lang-ja="注文が完了しました" data-lang-zh="订单已完成">
                    주문이 완료되었습니다
                  </h2>

                  <!-- 주문 정보 -->
                  <div class="order-details">
                    <div class="detail-row">
                      <span class="label" data-lang-ko="상품명" data-lang-en="Product" data-lang-ja="商品名"
                        data-lang-zh="产品名称">상품명</span>
                      <span class="value">특허뉴스PDF</span>
                    </div>
                    <div class="detail-row">
                      <span class="label" data-lang-ko="결제금액" data-lang-en="Amount" data-lang-ja="決済金額"
                        data-lang-zh="支付金额">결제금액</span>
                      <span class="value">99,000 KRW</span>
                    </div>
                  </div>

                  <!-- 완료 버튼 -->
                  <button type="button" class="complete-button" onclick="closeOrderPopup()">
                    <span data-lang-ko="확인" data-lang-en="Confirm" data-lang-ja="確認" data-lang-zh="确认">확인</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <style>
            .order-form {
              width: 100%;
              max-height: 80vh;
              overflow-y: auto;
              padding-right: 16px;
              scrollbar-width: thin;
              scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
            }

            .order-form::-webkit-scrollbar {
              width: 6px;
            }

            .order-form::-webkit-scrollbar-track {
              background: transparent;
            }

            .order-form::-webkit-scrollbar-thumb {
              background-color: rgba(255, 255, 255, 0.3);
              border-radius: 3px;
            }

            .order-detail-section {
              padding: 20px;
              background: rgba(255, 255, 255, 0.05);
              border-radius: 8px;
              margin-bottom: 16px;
            }

            .order-info>div:not(:last-child) {
              margin-bottom: 16px;
            }

            .form-subtitle {
              font-size: 1.1rem;
              font-weight: bold;
              margin-bottom: 15px;
              color: #f6f6f6;
            }

            .order-info {
              display: flex;
              flex-direction: column;
              gap: 15px;
            }

            .product-info {
              display: flex;
              gap: 20px;
              padding: 15px;
              color: #fcfcfc;
              background: rgba(255, 255, 255, 0.05);
              border-radius: 8px;
            }

            .product-image {
              width: 100px;
              height: 100px;
              overflow: hidden;
              border-radius: 4px;
            }

            .product-thumb {
              width: 100%;
              height: 100%;
              object-fit: cover;
            }

            .product-details {
              flex: 1;
            }

            .product-code {
              color: #666;
              font-size: 0.9rem;
            }

            .product-name {
              font-size: 1.1rem;
              font-weight: bold;
              margin: 5px 0;
            }

            .payment-details {
              background: rgba(255, 255, 255, 0.05);
              padding: 15px;
              border-radius: 8px;
            }

            .price-row {
              display: flex;
              justify-content: space-between;
              margin-bottom: 10px;
              color: #fcfcfc;
            }

            .price-row.discount {
              color: #ff4444;
            }

            .price-row.total {
              border-top: 1px solid rgba(255, 255, 255, 0.1);
              margin-top: 10px;
              padding-top: 10px;
              font-weight: bold;
              font-size: 1.1rem;
            }

            .privacy-consent {
              display: flex;
              flex-direction: column;
              gap: 10px;
            }

            .privacy-text {
              width: 100%;
              height: 150px;
              padding: 10px 4px;
              color: #fcfcfc;
              background: rgba(255, 255, 255, 0.05);
              border: 1px solid rgba(255, 255, 255, 0.1);
              border-radius: 4px;
              resize: none;
              margin-bottom: 10px;
            }

            .consent-check {
              display: flex;
              align-items: center;
              gap: 8px;
            }

            .payment-method {
              background: rgba(255, 255, 255, 0.05);
              padding: 15px;
              border-radius: 8px;
            }

            .method-option {
              display: flex;
              align-items: center;
              gap: 8px;
            }

            .method-option label.disabled {
              color: #666;
            }

            /* .normal-button {
              width: 100%;
              padding: 12px;
              background: var(--primary-color);
              color: white;
              border: none;
              border-radius: 4px;
              font-weight: bold;
              cursor: pointer;
              transition: background-color 0.3s;
            }

            .normal-button:hover {
              background: var(--primary-color-dark);
            } */

            @media (max-width: 768px) {
              .product-info {
                flex-direction: column;
                align-items: center;
                text-align: center;
              }

              .product-image {
                width: 150px;
                height: 150px;
              }
            }

            .file-upload-container {
              margin: 10px 0;
            }

            .file-upload-area {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              padding: 20px;
              border: 2px dashed #666;
              border-radius: 8px;
              background: transparent;
              cursor: pointer;
              transition: all 0.3s ease;
            }

            .file-upload-area:hover {
              border-color: #1a75ff;
              background: rgba(26, 117, 255, 0.05);
            }

            .file-upload-button {
              width: 50px;
              height: 50px;
              display: flex;
              align-items: center;
              justify-content: center;
              border: 2px solid #666;
              border-radius: 50%;
              cursor: pointer;
              transition: all 0.3s ease;
            }

            .file-upload-button:hover {
              border-color: #1a75ff;
              background: rgba(26, 117, 255, 0.1);
            }

            .plus-icon {
              font-size: 30px;
              color: #666;
              transition: color 0.3s ease;
            }

            .file-upload-button:hover .plus-icon {
              color: #1a75ff;
            }

            .file-help-text {
              margin-top: 10px;
              font-size: 12px;
              color: #666;
              text-align: center;
            }

            .file-preview {
              margin-top: 15px;
              padding: 10px;
              border-radius: 8px;
              background: rgba(255, 255, 255, 0.1);
            }

            /* .file-info {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
} */

            /* .remove-file {
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid #ff4444;
  border-radius: 50%;
  background: transparent;
  cursor: pointer;
  transition: all 0.3s ease;
} */

            /* .remove-file:hover {
  background: rgba(255, 68, 68, 0.1);
} */

            /* .minus-icon {
  font-size: 20px;
  color: #ff4444;
} */

            #fileName {
              color: #fff;
              word-break: break-all;
            }

            .error-message {
              margin-top: 10px;
              color: #ff4444;
              font-size: 14px;
            }

            .file-list {
              margin-top: 15px;
            }

            .file-item {
              display: flex;
              align-items: center;
              justify-content: space-between;
              padding: 8px 12px;
              margin-bottom: 8px;
              background: rgba(255, 255, 255, 0.1);
              border-radius: 4px;
            }

            .file-info {
              display: flex;
              align-items: center;
              gap: 10px;
              flex: 1;
            }

            .file-name {
              color: #fff;
              flex: 1;
              word-break: break-all;
            }

            .file-size {
              color: #999;
              font-size: 12px;
              white-space: nowrap;
            }

            .remove-file {
              width: 24px;
              height: 24px;
              min-width: 24px;
              display: flex;
              align-items: center;
              justify-content: center;
              border: 2px solid #ff4444;
              border-radius: 50%;
              background: transparent;
              cursor: pointer;
              transition: all 0.3s ease;
              margin-left: 10px;
            }

            .remove-file:hover {
              background: rgba(255, 68, 68, 0.1);
            }

            .minus-icon {
              font-size: 16px;
              color: #ff4444;
              line-height: 1;
            }

            .payment-form {
              display: none;
              width: 100%;
              margin-top: 20px;
            }

            .payment-form .input-box {
              margin-bottom: 20px;
            }

            .payment-form input {
              width: 100%;
              padding: 10px;
              border: 1px solid #ddd;
              border-radius: 4px;
              transition: border-color 0.3s;
            }

            .payment-form input:focus {
              border-color: #007bff;
              outline: none;
            }

            .payment-form .amount-wrapper {
              position: relative;
            }

            .payment-form .amount-wrapper input {
              text-align: right;
              padding-right: 50px;
            }

            .payment-form .amount-wrapper .currency {
              position: absolute;
              right: 10px;
              top: 50%;
              transform: translateY(-50%);
              color: #fcfcfc;
            }

            /* RTL 지원 */
            html[dir="rtl"] .amount-wrapper .currency {
              right: auto;
              left: 12px;
            }

            /* NICE Pay Modal Form */
            .nice-pay-modal {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              z-index: 1000;
            }

            .nice-pay-modal .modal-overlay {
              position: absolute;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
            }

            .nice-pay-modal .modal-content {
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: white;
              padding: 20px;
              border-radius: 8px;
            }

            /* 모달 오버레이 */
            .modal-overlay {
              position: fixed;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background: rgba(0, 0, 0, 0.7);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 1000;
            }

            /* 모달 컨텐츠 */
            .modal-content {
              position: relative;
              background: #1a1a1a;
              border-radius: 12px;
              padding: 0;
              max-width: 90%;
              width: 400px;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }

            /* 완료 팝업 스타일 */
            .complete-popup {
              padding: 32px;
              text-align: center;
              color: #fff;
            }

            /* 체크마크 아이콘 */
            .complete-icon {
              width: 64px;
              height: 64px;
              margin: 0 auto 24px;
              color: #4CAF50;
            }

            /* 완료 메시지 */
            .complete-title {
              font-size: 24px;
              font-weight: bold;
              margin-bottom: 24px;
              color: #fff;
            }

            /* 주문 정보 */
            .order-details {
              background: rgba(255, 255, 255, 0.05);
              color: #fcfcfc;
              border-radius: 8px;
              padding: 16px;
              margin-bottom: 24px;
            }

            .detail-row {
              display: flex;
              justify-content: space-between;
              padding: 8px 0;
            }

            .detail-row .label {
              color: rgba(255, 255, 255, 0.7);
            }

            /* 완료 버튼 */
            .complete-button {
              background: var(--primary-color, #4CAF50);
              color: white;
              border: none;
              border-radius: 4px;
              padding: 12px 32px;
              font-size: 16px;
              font-weight: bold;
              cursor: pointer;
              transition: background-color 0.3s;
              width: 100%;
            }

            .complete-button:hover {
              background: var(--primary-color-dark, #388E3C);
            }

            
          </style>
          <script>
            // 언어 라벨 설정
            const langLabel2 = {
              ko: "한국어",
              en: "English",
              ja: "日本語",
              zh: "中文"
            };


            const showError = (message) => {
              console.error('Error message:', message);
              errorMessage.textContent = message;
              errorMessage.style.display = 'block';
            };

            // 결제 완료 팝업 표시 함수 - CurrencyService 활용
            function showOrderCompletePopup(data) {
              const popup = document.getElementById('orderCompletePopup');
              if (!popup) return;
              
              const currentLang = localStorage.getItem('preferredLanguage') || 'ko';
              const formattedAmount = window.currencyService.formatCurrencyByLanguage(
                data.amount,
                currentLang
              );
              
              // 팝업 내용 업데이트
              const productNameEl = popup.querySelector('.value');
              const amountEl = popup.querySelector('.value:nth-child(2)');
              
              if (productNameEl) productNameEl.textContent = data.productName;
              if (amountEl) amountEl.textContent = formattedAmount;
              
              popup.style.display = 'block';
            }

            // // privacy-text 포맷팅 함수
            // function formatPrivacyText() {
            //   const privacyTextarea = document.querySelector('textarea.privacy-text');
            //   if (!privacyTextarea) return;

            //   // 현재 언어 가져오기
            //   const currentLang2 = getCurrentLanguage();

            //   console.log(`formatPrivacyText -> ${currentLang2}`);

            //   // 현재 언어의 텍스트 가져오기
            //   let content = privacyTextarea.getAttribute(`data-lang-${currentLang2}`);
            //   if (!content) return;

            //   // 텍스트 포맷팅
            //   content = content
            //     // 1. 번호 앞에 줄바꿈 추가 (첫 번째 번호 제외)
            //     .replace(/([^1]|\s)(\d+\.)/g, '$1\n$2')
            //     // 2. 하이픈 앞에 줄바꿈과 들여쓰기 추가
            //     .replace(/\s*-\s*/g, '\n    - ')
            //     // 3. 연속된 공백 제거
            //     .replace(/\s+/g, ' ')
            //     // 4. 각 줄 앞뒤 공백 제거
            //     .split('\n')
            //     .map(line => line.trim())
            //     .filter(line => line) // 빈 줄 제거
            //     .join('\n');

            //   // 포맷팅된 텍스트를 textarea에 설정
            //   privacyTextarea.value = content;
            // }


            // 여기에 아래 코드 추가
            // import { CurrencyService } from './currency.js';
            // import { processTextByLanguage, applyLanguageText, updatePageLanguage, getCurrentLanguage, langLabelbv } from './language.js';
            // import { getErrorMessage, showError } from './error_messages.js';

            // PreviewProductService 클래스 정의
            // class PreviewProductExManager {
            //   static #instance;
            //   #textarea;

            //   constructor() {
            //     if (PreviewProductExManager.#instance) {
            //       return PreviewProductExManager.#instance;
            //     }
            //     PreviewProductExManager.#instance = this;

            //     this.#textarea = document.getElementById('previewProductEx');
            //     this.#initializeEventListeners();
            //   }

            //   #initializeEventListeners() {

            //     // 언어 변경을 감지하기 위해 dropdown과 sidebar의 언어 선택 요소들을 모니터링
            //     document.querySelectorAll('.dropdown-menu .dropdown-item, .side-bar-list.lang .side-bar-item').forEach(item => {
            //       item.addEventListener('click', async () => {
            //         // 약간의 지연 후 현재 언어로 콘텐츠 업데이트
            //         setTimeout(async () => {
            //           await this.updateContent(getCurrentLanguage());
            //         }, 100);
            //       });
            //     });

            //     // 페이지 선택 이벤트 리스너
            //     document.querySelectorAll('.nav-item').forEach(item => {
            //       item.addEventListener('click', async () => {
            //         if (item.getAttribute('data-page') === 'listing') {
            //           await this.updateContent(getCurrentLanguage());
            //         }
            //       });
            //     });
            //   }

            //   async initializeContent() {
            //     if (!this.#textarea) {
            //       console.error('Textarea element not found');
            //       return;
            //     }

            //     try {
            //       const currentLang2 = localStorage.getItem('preferredLanguage') || 'ko';
            //       await this.updateContent(currentLang2);
            //     } catch (error) {
            //       console.error('Failed to initialize content:', error);
            //     }
            //   }

            //   async updateContent(lang) {
            //     try {
            //       const response = await fetch('js/translations.json');
            //       if (!response.ok) {
            //         throw new Error(`HTTP error! status: ${response.status}`);
            //       }
            //       const translationsData = await response.json();

            //       if (translationsData[lang]?.listing?.previewProductEx) {
            //         const contentArray = translationsData[lang].listing.previewProductEx;
            //         let formattedContent = contentArray.join('')
            //           .replace(/&lt;/g, '<')
            //           .replace(/&gt;/g, '>')
            //           .replace(/&quot;/g, '"')
            //           .replace(/&#039;/g, "'")
            //           .replace(/&amp;/g, '&');

            //         // this.#textarea.value = formattedContent;
            //         formattedContent = this.#convertBrToNewline(formattedContent);
            //         this.#textarea.value = formattedContent;
            //         this.#adjustTextareaHeight();
            //       }
            //     } catch (error) {
            //       console.error('Error updating preview content:', error);
            //     }
            //   }

            //   // br 태그를 줄바꿈으로 변환하는 private 메서드 추가
            //   #convertBrToNewline(text) {
            //     // 다양한 형태의 br 태그 처리
            //     return text
            //       .replace(/<br\s*\/?>/gi, '\n')  // <br>, <br/>, <br /> 등 모든 형태의 br 태그 처리
            //       .replace(/\\n/g, '\n')          // \n 문자열을 실제 줄바꿈으로 변환
            //       .replace(/\n\s*\n/g, '\n\n')    // 연속된 줄바꿈 정리
            //       .replace(/^\s+|\s+$/g, '');    // 앞뒤 공백 제거
            //   }

            //   #adjustTextareaHeight() {
            //     this.#textarea.style.height = 'auto';
            //     this.#textarea.style.height = `${this.#textarea.scrollHeight + 2}px`;
            //   }
            // }

            // 기존 언어 변경 핸들러 수정
            /**
            function handleLangChange(lang, fromSidebar = false) {
              try {
                document.querySelectorAll('[data-lang-' + lang + ']').forEach(element => {
                  element.textContent = element.getAttribute('data-lang-' + lang);
                  if (element.hasAttribute('data-placeholder-' + lang)) {
                    element.placeholder = element.getAttribute('data-placeholder-' + lang);
                  }
                });

                window.dispatchEvent(new Event('languageChange'));

                if (window.currencyService) {
                  window.currencyService.updatePriceDisplay(lang);
                }

                setLanguage(lang);
                if (fromSidebar) {
                  handleBurgerMenuClose();
                }
              } catch (error) {
                console.error('Error in handleLangChange:', error);
              }
            } **/
            
            // function generateOrderId() {
            //   const date = new Date();
            //   const timestamp = date.getTime().toString();
            //   const random = Math.random().toString(36).substring(2, 8);
            //   return `ORD${timestamp}${random}`;
            // }

            
            // order_id 생성 함수
            function generateOrderId() {
              const date = new Date();
              const timestamp = date.getTime().toString();
              const random = Math.random().toString(36).substring(2, 8);
              return `ORD${timestamp}${random}`;
            }
           

            /**
             * 4. 메인 이벤트 리스너 (변경 필요)
             * - 개별 기능별로 분리 필요
             * [nicepay-pgweb] Amt 필드는 정수 값만 설정 가능합니다.
             */

            document.addEventListener('DOMContentLoaded', async function () {
              console.log('Form handling script loaded');

              // import
              // const currencyService = new CurrencyService();
              // const languageService = new LanguageService();


              // const productPreviewForm = document.getElementById('productPreviewForm');
              const orderForm = document.getElementById('orderForm');
              const contactForm = document.getElementById('contactForm');

              const dropdown = document.querySelector('.dropdown');
              const dropdown_menu = document.querySelector('.dropdown-menu');

              const fileInput = document.getElementById('file');
              const fileList = document.getElementById('fileList');
              const errorMessage = document.getElementById('errorMessage');

              const privacyTxt = document.querySelector('.privacy-text');

              const previewProductEx = document.getElementById('previewProductEx');


              // 맨 위에 추가
              let uploadedFiles = new Map();

              let divValue = '';
              let pageLang = '';
              let orderId = '';

              // 로컬 스토리지에서 저장된 언어 설정을 가져옴
              const currentLang = languageService.getCurrentLanguage(); // localStorage.getItem('preferredLanguage') || 'en';
              // 현재 저장된 언어 가져오기
              const savedLang = localStorage.getItem('preferredLanguage') || 'ko';
              const selectedLang = localStorage.getItem('preferredLanguage') || 'en'; // 기본값은 'ko'


              if (!contactForm || !fileInput || !fileList || !errorMessage || !orderForm || !privacyTxt || !dropdown) {
                console.error('Required DOM elements not found.');
                return; // 필수 요소가 없을 때 스크립트 중단
              }

              // 거래 id 생성
              orderId = generateOrderId();

              dropdown_menu.addEventListener('click', (event) => {
                const liElement = event.target.closest('li');
                if (liElement) {
                  const divElement = liElement.querySelector('div'); // li 안의 div 찾기
                  if (divElement) {
                    divValue = divElement.textContent.trim(); // div 값 가져오기

                    if (divValue == '한국어') {
                      pageLang = 'ko';
                    }
                    if (divValue == 'English') {
                      pageLang = 'en';
                    }
                    if (divValue == '日本語') {
                      pageLang = 'ja';
                    }
                    if (divValue == '中文') {
                      pageLang = 'zh';
                    }

                  }

                }
                // debug line 324
                console.log(`divValue + ${divValue}`, `pageLang + ${pageLang}`);
              })



              updatePageLanguage(currentLang);

              // 디바이스 최적화
              if (deviceService.isMobileDevice()) {
                // 모바일 최적화 코드
                document.body.classList.add('mobile');
              }

              // 초기 상태 설정 lee
              productPreviewForm.style.display = 'none';
              orderForm.style.display = 'block';
              contactForm.style.display = 'none';

              // 파일 업로드 관련 메시지의 다국어 처리
              const fileUploadMessages = {
                ko: {
                  allowedTypes: '허용된 파일 형식: PDF, DOC, DOCX. 최대 파일 크기: 5MB',
                  invalidType: '허용된 파일 형식이 아닙니다. PDF, DOC, DOCX 파일만 업로드 가능합니다.',
                  sizeExceeded: '파일 크기가 5MB를 초과합니다.',
                  dragAndDrop: '파일을 드래그하여 놓거나 클릭하여 선택하세요',
                  delete: '삭제'
                },
                en: {
                  allowedTypes: 'Allowed file types: PDF, DOC, DOCX. Maximum file size: 5MB',
                  invalidType: 'Invalid file type. Only PDF, DOC, DOCX files are allowed.',
                  sizeExceeded: 'File size exceeds 5MB limit.',
                  dragAndDrop: 'Drag and drop files here or click to select',
                  delete: 'Delete'
                },
                ja: {
                  allowedTypes: '許可されているファイル形式：PDF、DOC、DOCX。最大ファイルサイズ：5MB',
                  invalidType: '無効なファイル形式です。PDF、DOC、DOCXファイルのみアップロード可能です。',
                  sizeExceeded: 'ファイルサイズが5MBを超えています。',
                  dragAndDrop: 'ファイルをドラッグ＆ドロップまたはクリックして選択',
                  delete: '削除'
                },
                zh: {
                  allowedTypes: '允许的文件类型：PDF、DOC、DOCX。最大文件大小：5MB',
                  invalidType: '文件类型无效。仅允许PDF、DOC、DOCX文件。',
                  sizeExceeded: '文件大小超过5MB限制。',
                  dragAndDrop: '拖放文件到这里或点击选择',
                  delete: '删除'
                }
              };

              // 결제 폼 관련 다국어 에러 메시지
              const paymentErrorMessages = {
                ko: {
                  name_mismatch: '카드 소유자 이름이 입력하신 이름과 일치하지 않습니다.',
                  invalid_card: '올바른 카드 번호를 입력해주세요.',
                  invalid_expiry: '올바른 만료일을 입력해주세요.',
                  invalid_cvv: '올바른 CVV를 입력해주세요.',
                  payment_failed: '결제 처리에 실패했습니다.',
                  payment_success: '결제가 완료되었습니다.',
                  processing_error: '결제 처리 중 오류가 발생했습니다.'
                },
                en: {
                  name_mismatch: 'Cardholder name does not match the name you entered.',
                  invalid_card: 'Please enter a valid card number.',
                  invalid_expiry: 'Please enter a valid expiry date.',
                  invalid_cvv: 'Please enter a valid CVV.',
                  payment_failed: 'Payment processing failed.',
                  payment_success: 'Payment completed successfully.',
                  processing_error: 'An error occurred during payment processing.'
                },
                ja: {
                  name_mismatch: 'カード名義人が入力された名前と一致しません。',
                  invalid_card: '有効なカード番号を入力してください。',
                  invalid_expiry: '有効な有効期限を入力してください。',
                  invalid_cvv: '有効なCVVを入力してください。',
                  payment_failed: '決済処理に失敗しました。',
                  payment_success: '決済が完了しました。',
                  processing_error: '決済処理中にエラーが発生しました。'
                },
                zh: {
                  name_mismatch: '持卡人姓名与您输入的姓名不符。',
                  invalid_card: '请输入有效的卡号。',
                  invalid_expiry: '请输入有效的有效期。',
                  invalid_cvv: '请输入有效的CVV。',
                  payment_failed: '支付处理失败。',
                  payment_success: '支付已完成。',
                  processing_error: '支付处理过程中发生错误。'
                }
              };

              // 제품 정보 데이터 정의 - 실제 결제될 가격 설정
              const productData = {
                ko: {
                  productName: '특허뉴스PDF',
                  basePrice: 99000,  // KRW
                  currency: 'KRW',
                  currencySymbol: '₩'
                },
                en: {
                  productName: 'Patent News PDF',
                  basePrice: 75,     // USD
                  currency: 'USD',
                  currencySymbol: '$'
                },
                ja: {
                  productName: '特許ニュースPDF',
                  basePrice: 11000,  // JPY
                  currency: 'JPY',
                  currencySymbol: '¥'
                },
                zh: {
                  productName: '专利新闻PDF',
                  basePrice: 485,    // CNY
                  currency: 'CNY',
                  currencySymbol: '¥'
                }
              };

              // 드롭다운 버튼 텍스트 업데이트
              const dropdownButton = document.getElementById('dropdownMenuButton1');
              if (dropdownButton) {
                dropdownButton.textContent = langLabel2[savedLang];
              }

              // 사이드바 언어 active 상태 업데이트
              document.querySelectorAll('.side-bar-item.lang span').forEach(el => {
                el.classList.remove('active');
                if (el.textContent === langLabel2[savedLang]) {
                  el.classList.add('active');
                }
              });

              // contactForm 표시 설정 - style="display: none" 제거
              // const contactForm = document.getElementById('contactForm');
              // if (contactForm) {
              //   contactForm.style.display = 'block';
              // }
              // 가격과 통화 관련 데이터를 전역으로 관리할 객체 생성
              const paymentData = {
                  basePrice: null,
                  convertedPrice: null,
                  currency: null
              };


              // 상품 미리보기 폼 제출 처리
              productPreviewForm.addEventListener('submit', async function (e) {
                e.preventDefault();
                console.log('Product Preview form submission started');

                // 현재 언어 설정 가져오기
                const currentLang2 = localStorage.getItem('preferredLanguage') || 'en';

                productPreviewForm.style.display = 'none';

                languageService.changeLanguage(currentLang2);

                // orderForm 표시 및 언어 적용
                // const orderForm = document.getElementById('orderForm');
                // orderForm.style.display = 'block';

                // orderForm의 텍스트 업데이트
                // updateFormLanguage(orderForm, currentLang);

                // console.log('productPreviewForm -> ' + currentLang2);

                // updatePageLanguage(currentLang);

                // order_id 생성 함수
                

                try {

                  // CurrencyService를 통한 현재 언어 및 통화 정보 가져오기
                  const currentLang = localStorage.getItem('preferredLanguage') || 'ko';
                  const currencyService = window.currencyService;

                  if (!currencyService) {
                      throw new Error('Currency service is not initialized');
                  }

                  const currencyConfig = currencyService.currencyConfig[currentLang];

                  if (!currencyConfig) {
                    throw new Error('통화 설정을 찾을 수 없습니다.');
                  }
                  
                  console.log('currencyConfig -> '+currencyConfig);

                  // hidden_orderPrice에서 기본 가격(KRW) 가져오기
                  // 기본 가격(KRW)과 변환된 가격 계산
                  // const basePrice = document.getElementById('hidden_orderPrice').value;
                  // const convertedPrice = basePrice * currencyService.exchangeRates[currencyConfig.currency];

                  // orderId = generateOrderId(); // order_id 생성

                  // 기본 가격(KRW)
                  const basePrice = 99000;

                  // 현재 통화
                  const currency = currencyConfig.currency

                  // 환율 차액 계산
                  // const rateInfo = window.exchangeRateService.calculateRateDifference(currency);
                  // 환율 정보 계산
                  const rateInfo = window.exchangeRateService.calculateExchangeRate(currency);
                  console.log(rateInfo);

                  // 변환된 가격 계산
                  const convertedPrice = basePrice * rateInfo.currentRate;

                  // 전역 객체에 가격 정보 저장
                  // 상품 디스플레이 가격
                  // paymentData.basePrice = document.getElementById('hidden_orderPrice').value;
                  // 화폐 단위
                  // paymentData.currency = currencyConfig.currency;
                  // 환율 USD = 1
                  // paymentData.convertedPrice = paymentData.basePrice * currencyService.exchangeRates[currencyConfig.currency];

                  // currencyService.calculateFees();
                  // console.log(currencyService.fee);

                  // const previewPrice = document.getElementById('previewPrice');
                  // const hiddenPrice = document.getElementById('hidden_orderPrice');

                  // // 가격에서 통화 기호와 쉼표 제거
                  // const priceValue = hiddenPrice.value || previewPrice.value.replace(/[^0-9.-]+/g, '');
                  // const currency = hiddenPrice.getAttribute('data-currency') || 'KRW';

                  // // 현재 선택된 통화로 가격 변환
                  // const convertedPrice = basePrice * currencyService.exchangeRates[currencyConfig.currency];

                  // hidden field 업데이트
                  // document.getElementById('hidden_orderPrice').value = paymentData.convertedPrice;

                  // Order Form으로 데이터 전달
                  document.getElementById('hidden_orderProductCode').value = document.getElementById('previewProductCode').value;
                  document.getElementById('hidden_orderProductName').value = document.getElementById('previewProductName').value;
                  document.getElementById('hidden_orderQuantity').value = document.getElementById('previewQuantity').value;

                  const formData = {
                    order_id: orderId,              // 생성된 order_id 추가
                    productCode: document.getElementById('previewProductCode').value,
                    productName: document.getElementById('previewProductName').value,
                    quantity: document.getElementById('previewQuantity').value,
                    price: basePrice,
                    currency: currency,
                    exchangeRate: rateInfo.exchangeRate,
                    convertedPrice: rateInfo.convertedPrice
                  };

                  console.log('Sending preview data:', formData);

                  const saveResponse = await fetch('save_product_preview.php', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                  });

                  if (!saveResponse.ok) {
                    throw new Error('Failed to save product preview');
                  }

                  // Order Form으로 데이터 전달
                  // document.getElementById('hidden_orderProductCode').value = document.getElementById('previewProductCode').value;
                  // document.getElementById('hidden_orderProductName').value = document.getElementById('previewProductName').value;
                  // document.getElementById('hidden_orderQuantity').value = document.getElementById('previewQuantity').value;
                  // document.getElementById('hidden_orderPrice').value = paymentData.convertedPrice;
                  

                  // Order Form으로 데이터 전달 및 화면 전환
                  productPreviewForm.style.display = 'none';
                  const orderForm = document.getElementById('orderForm');
                  orderForm.style.display = 'block';


                  // orderForm의 텍스트 업데이트
                  updateFormLanguage(orderForm, currentLang);

                  // Order Form에 데이터 설정
                  // document.getElementById('hidden_productCode').value = previewData.productCode;
                  // document.getElementById('hidden_productName').value = previewData.productName;
                  // document.getElementById('hidden_price').value = previewData.price;                  

                } catch (error) {
                  console.error('Product preview error:', error);
                  // alert('처리 중 오류가 발생했습니다.');
                  showToast(error.message || '처리 중 오류가 발생했습니다.', 'error');
                  window.errorService.handleError(error, getCurrentLanguage(), 'form_submission_failed');
                }
              });

              // fetchCountries(selectedLang);

              // 전역 상태 객체 생성
              window.paymentState = {
                  currentLang: null,
                  basePrice: null,
                  convertedPrice: null,
                  currency: null
              };

              // Order Form 제출 처리 수정
              orderForm.addEventListener('submit', async function (e) {
                e.preventDefault();
                console.log('Order form submission started');

                try {

                  // 1. 디바이스 체크
                  const isMobile = window.deviceService.isMobileDevice();
                  console.log('Device check:', isMobile ? 'Mobile' : 'Desktop');

                  // 1. 서비스 초기화 체크 
                  if (typeof window.currencyService === 'undefined' || typeof window.exchangeRateService === 'undefined') {
                      throw new Error('결제 서비스 초기화 중입니다. 잠시 후 다시 시도해주세요.');
                  }

                  // 서비스 초기화 체크
                  if (typeof window.currencyService === 'undefined') {
                      throw new Error('결제 서비스 초기화 중입니다. 잠시 후 다시 시도해주세요.');
                  }

                  // 2. 현재 언어 및 통화 설정 가져오기
                  const currentLang = localStorage.getItem('preferredLanguage') || 'ko';
                  const currencyService = window.currencyService;
                  const currencyConfig = window.currencyService.currencyConfig[currentLang];
                  // const currency = this.dataset.currency;
                  // const basePrice = this.dataset.basePrice;
                  
                      
                  // if (!currencyConfig) {
                  //   throw new Error('통화 설정을 찾을 수 없습니다.');
                  // }

                  const currencyMap = {
                    ko: 'KRW',
                    en: 'USD',
                    ja: 'JPY',
                    zh: 'CNY'
                  };
                  // const currency = currencyMap[currentLang];

                  // 환율이 적용된 가격 계산
                  // const originalPrice = document.getElementById('hidden_orderPrice').value;
                  // let convertedAmount;

                  // if (window.exchangeRateService) {
                  //   // 환율 적용된 금액 (숫자만)
                  //   convertedAmount = window.exchangeRateService.getNumericPrice(currency);
                  // }

                  // 가격과 통화 관련 변수들 (기존 코드)
                  // const originalPrice = document.getElementById('hidden_orderPrice').value; // KRW 가격
                  // const currency = getCurrentCurrency(); // 현재 선택된 통화
                  // const convertedAmount = getConvertedAmount(); // 환율 적용된 해당 통화 금액

                  // const basePrice = document.getElementById('hidden_orderPrice').value;
                  // const convertedPrice = basePrice * currencyService.exchangeRates[currencyConfig.currency];

                  // Product Preview 데이터 수집
                  // 1. 폼 데이터 수집
                  // const orderData = {
                  //   orderName: document.getElementById('orderName').value,
                  //   orderEmail: document.getElementById('orderEmail').value,
                  //   orderPhone: document.getElementById('orderPhone').value,
                  //   orderMemo: document.getElementById('orderMemo').value,
                  //   productCode: document.getElementById('hidden_orderProductCode').value,
                  //   productName: document.getElementById('hidden_orderProductName').value,
                  //   quantity: document.getElementById('hidden_orderQuantity').value,
                  //   // price: document.getElementById('hidden_orderPrice').value,
                  //   price: convertedAmount,  // 환율 적용된 금액
                  //   currency: currency,      // 통화 정보 추가
                  //   privacyConsent: document.getElementById('privacyConsent').checked ? 'Y' : 'N',
                  //   //csrf_token: document.querySelector('input[name="csrf_token"]')?.value // CSRF 토큰은 일단 제외
                  // };


                  // 3. 기본 가격(KRW) 가져오기
                  // const basePrice = document.getElementById('hidden_orderPrice').value;
                  
                  // 4. 현재 선택된 통화로 가격 변환
                  // const currency = currencyConfig.currency; // 여기서 currency 변수 초기화
                  // const convertedPrice = basePrice * window.currencyService.exchangeRates[currency];


                  // orderData 객체 수정
                  // const orderData = {
                  //   orderName: document.getElementById('orderName').value,
                  //   orderEmail: document.getElementById('orderEmail').value,
                  //   orderPhone: document.getElementById('orderPhone').value,
                  //   orderMemo: document.getElementById('orderMemo').value,
                  //   productCode: document.getElementById('hidden_orderProductCode').value,
                  //   productName: document.getElementById('hidden_orderProductName').value,
                  //   quantity: document.getElementById('hidden_orderQuantity').value,
                  //   price: convertedPrice,
                  //   price_krw: basePrice,              // 원화 기준가 저장
                  //   currency: currencyConfig.currency, // 통화 정보
                  //   privacyConsent: document.getElementById('privacyConsent').checked ? 'Y' : 'N'
                  // };

                  // 3. 기준 가격 설정 (KRW 99,000원)
                  const BASE_PRICE_KRW = 99000;
                  // const currentLang = localStorage.getItem('preferredLanguage') || 'ko';

                  // 3. 현재 언어에 따른 통화 정보 설정
                  const currencyInfo = {
                      ko: { currency: 'KRW', rate: 1 },
                      en: { currency: 'USD', rate: window.currencyService.exchangeRates['USD'] },
                      ja: { currency: 'JPY', rate: window.currencyService.exchangeRates['JPY'] },
                      zh: { currency: 'CNY', rate: window.currencyService.exchangeRates['CNY'] }
                  }[currentLang];

                  // 4. 가격 계산
                  let calc_price;
                  if (currentLang === 'ko') {
                    calc_price = BASE_PRICE_KRW;
                  } else {
                    if (currencyInfo.currency === 'JPY') {
                      calc_price = Math.round(BASE_PRICE_KRW * currencyInfo.rate); // JPY는 원래 정수
                    } else {
                      // USD와 CNY의 경우 소수점 2자리에서 반올림 후 100을 곱해서 정수로 변환
                      calc_price = Math.round(BASE_PRICE_KRW * currencyInfo.rate * 100);
                    }
                  }


                  // 5. 주문 데이터 구성 lee
                  const orderData = {
                      order_id: orderId,
                      // orderName: document.getElementById('orderName').value,
                      // orderEmail: document.getElementById('orderEmail').value,
                      // orderPhone: document.getElementById('orderPhone').value,
                      // orderMemo: document.getElementById('orderMemo').value,
                      productCode: document.getElementById('hidden_orderProductCode').value,
                      productName: document.getElementById('hidden_orderProductName').value,
                      quantity: document.getElementById('hidden_orderQuantity').value,
                      price: BASE_PRICE_KRW,
                      currency: currencyInfo.currency,
                      privacyConsent: document.getElementById('privacyConsent').checked ? 'Y' : 'N'
                  };

                  // 3. 필수 입력값 검증
                  // if (!orderData.orderName || !orderData.orderEmail || !orderData.orderPhone) {
                  //     throw new Error('필수 입력 항목을 모두 입력해주세요.');
                  // }

                  

                  console.log('Sending order data: ', orderData); // 디버깅용 로그

                  // 3. 현재 통화 설정 가져오기
                  // const currentLang = localStorage.getItem('preferredLanguage') || 'ko';
                  // const basePrice = document.getElementById('hidden_orderPrice').value;

                  // 5. 통화 정보 가져오기 (KRW 기준)
                  // const currencyInfo = window.currencyService.currencyConfig[currentLang];
                  // const currencyRate = window.exchangeRateService.rates[currencyInfo.currency] || 1;

                  // 6. 가격 정보 추가
                  // orderData.price = Math.round(basePrice * currencyRate * 100) / 100; // 소수점 2자리까지
                  // orderData.price_krw = basePrice;
                  // orderData.currency = currencyInfo.currency;
                  // orderData.privacyConsent = document.getElementById('privacyConsent').checked ? 'Y' : 'N';

                  // const config = currencyService.currencyConfig[currentLang];

                  // 6. 통화 및 가격 정보 추가
                  // const currencyInfo = currencyService.currencyConfig[currentLang];
                  // if (!currencyInfo) {
                  //     throw new Error('통화 설정을 찾을 수 없습니다.');
                  // }

                  // if (!currencyConfig) {
                  //     throw new Error('통화 설정을 찾을 수 없습니다.');
                  // }

                  // if (!config) {
                  //     throw new Error('통화 설정을 찾을 수 없습니다.');
                  // }

                  // 5. 가격 정보 추가
                  // orderData.price = convertedAmount;
                  // orderData.price_krw = basePrice;
                  // orderData.currency = currencyConfig.currency;
                  // orderData.privacyConsent = document.getElementById('privacyConsent').checked ? 'Y' : 'N';

                  // 디버깅을 위한 로그
                  // console.log('Validation Data:', {
                  //   productCode: orderData.productCode,
                  //   price: orderData.price,
                  //   currency: orderData.currency,
                  //   lang: currentLang
                  // });

                  // 가격 검증
                  // const isValidAmount = window.PaymentValidator.validatePaymentAmount(
                  //   orderData.productCode,
                  //   orderData.price,
                  //   currentLang
                  // );

                  // if (!isValidAmount) {
                  //   console.error('Price validation failed:', {
                  //     actual: orderData.price,
                  //     currency: orderData.currency
                  //   });
                  //   throw new Error('결제 금액이 유효하지 않습니다.');
                  // }

                  // 결제 금액 검증
                  // if (!window.PaymentValidator.validatePaymentAmount(
                  //   orderData.productCode,
                  //   orderData.price,
                  //   localStorage.getItem('preferredLanguage') || 'ko'
                  // )) {
                  //   throw new Error('결제 금액이 유효하지 않습니다.');
                  // }

                  // 2. 데이터 검증
                  // if (!orderData.orderName || !orderData.orderEmail || !orderData.orderPhone) {
                  //   throw new Error('필수 입력 항목을 모두 입력해주세요.');
                  // }

                  // console.log('Sending order data:', orderData);

                  // 세션에 주문 데이터 저장
                  // js/servics/session-manager.js
                  // 7. 세션 저장
                  // if (window.paymentSessionManager) {
                  //     await window.paymentSessionManager.saveOrderData(orderData);
                  // }
                  // window.paymentSessionManager.saveOrderData(orderData);

                  // console.log('Sending order data:', orderData);

                  // 3. 서버로 데이터 전송
                  const response = await fetch('process_order.php', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                  });

                  const result = await response.json();
                  console.log('Order submission response:', result);

                  // if (!saveResult.success) {
                  //   throw new Error(saveResult.message || '주문 저장에 실패했습니다.');
                  // }

                  // if (!result.success) {
                  //   throw new Error(result.message || '주문 처리에 실패했습니다.');
                  // }



                  // 4. 나이스결제 요청을 위한 폼 생성
                  // const paymentForm = document.createElement('form');
                  // paymentForm.method = 'POST';
                  // // 모바일 여부에 따라 다른 결제 페이지로 전송
                  // // paymentForm.action = isMobile ? 'mpayRequest_utf.php' : 'payRequest_utf.php';
                  // // paymentForm.action = 'payRequest_utf.php';
                  // paymentForm.action = 'cardKeyin_Request.php';

                  // // payRequest_utf.php에 필요한 데이터 전송
                  // const paymentData = {
                  //     order_id: orderId,
                  //     productCode: orderData.productCode,
                  //     productName: orderData.productName,
                  //     orderName: orderData.orderName,
                  //     orderPhone: orderData.orderPhone,
                  //     orderEmail: orderData.orderEmail,
                  //     convertedAmount: BASE_PRICE_KRW, //orderData.price,
                  //     currency: 'KRW', // orderData.currency
                  //     // 모바일 여부 추가
                  //     deviceType: isMobile ? 'mobile' : 'desktop'                      
                  // };

                  // cardKeyin_Request.php에 필요한 데이터 전송
                  // const paymentData = {
                  //     order_id: orderId,
                  //     productCode: orderData.productCode,
                  //     productName: orderData.productName,
                  //     orderName: orderData.orderName,
                  //     orderPhone: orderData.orderPhone,
                  //     orderEmail: orderData.orderEmail,
                  //     convertedAmount: BASE_PRICE_KRW, //orderData.price,
                  //     currency: 'KRW', // orderData.currency
                  //     // 모바일 여부 추가
                  //     deviceType: isMobile ? 'mobile' : 'desktop'                      
                  // };

                  // 결제에 필요한 데이터 추가
                  // const paymentData = {
                  //   OrderID: result.orderID,
                  //   GoodsName: orderData.productName,
                  //   Amt: orderData.price,
                  //   BuyerName: orderData.orderName,
                  //   BuyerTel: orderData.orderPhone,
                  //   BuyerEmail: orderData.orderEmail,
                  //   Currency: orderData.currency
                  // };

                  // hidden input 필드 생성
                  // Object.entries(paymentData).forEach(([key, value]) => {
                  //   const input = document.createElement('input');
                  //   input.type = 'hidden';
                  //   input.name = key;
                  //   input.value = value;
                  //   paymentForm.appendChild(input);
                  // });
                  
                  // hidden input 필드 생성
                  // Object.entries(paymentData).forEach(([key, value]) => {
                  //     const input = document.createElement('input');
                  //     input.type = 'hidden';
                  //     input.name = key;
                  //     input.value = value;
                  //     paymentForm.appendChild(input);
                  // });

                  // 5. 결제 요청 페이지로 전송
                  // document.body.appendChild(paymentForm);
                  // paymentForm.submit();

                  // if (!result.success) {
                  //   throw new Error(result.message || '주문 처리에 실패했습니다.');
                  // }

                  // if (result.success) {
                  //   // 결제창 호출을 위한 폼 생성
                  //   const payForm = document.createElement('form');
                  //   payForm.name = 'payForm';
                  //   payForm.method = 'post';
                  //   payForm.action = 'payRequest_utf.php';
                  //   payForm.style.display = 'none';

                  //   // 결제 핸들러 객체 생성
                  //   window.paymentHandler = {
                  //     handlePaymentSuccess: function (response) {
                  //       console.log('Payment Success:', response);
                  //       showToast('결제가 성공적으로 완료되었습니다.', 'success');
                  //       // 결제창 닫기
                  //       if (window.opener) {
                  //         window.opener.location.href = 'listing.html';
                  //         window.close();
                  //       } else {
                  //         window.location.href = 'listing.html';
                  //       }
                  //     },
                  //     handlePaymentError: function (error) {
                  //       console.error('Payment Error:', error);
                  //       showToast(error.message || '결제 처리 중 오류가 발생했습니다.', 'error');
                  //       // 결제창 닫기
                  //       if (window.opener) {
                  //         window.opener.location.href = 'listing.html';
                  //         window.close();
                  //       } else {
                  //         window.location.href = 'listing.html';
                  //       }
                  //     }
                  //   };

                  //   // 결제 취소 시 처리 함수 추가
                  //   window.nicepayClose = function () {
                  //     showToast('결제가 취소되었습니다.', 'info');
                  //     if (window.opener) {
                  //       window.opener.location.href = 'listing.html';
                  //       window.close();
                  //     } else {
                  //       window.location.href = 'listing.html';
                  //     }
                  //   };

                  //   // NicePay 결제 파라미터 설정
                  //   // Object.entries(result.paymentData).forEach(([key, value]) => {
                  //   //   const input = document.createElement('input');
                  //   //   input.type = 'hidden';
                  //   //   input.name = key;
                  //   //   input.value = value;
                  //   //   payForm.appendChild(input);
                  //   // });

                  //   // body에 폼 추가
                  //   // document.body.appendChild(payForm);

                  //   // NicePay 결제창 호출
                  //   // goPay(payForm);
                  // }

                  // 주문 저장 성공 후 카드 결제 팝업 표시
                  // const cardPaymentPopup = document.getElementById('cardPaymentPopup');
                  if (result.success) {
                    // 성공시 orderFormData를 세션 스토리지에 저장
                    // sessionStorage.setItem('orderFormData', JSON.stringify(orderData));

                    // 주문 저장 성공 시 cardKeyin_Request.php로 리다이렉션
                    // const form = document.createElement('form');
                    // form.method = 'POST';
                    // form.action = 'cardKeyin_Request.php';

                    // 현재 언어 정보 추가
                    const currentLang = localStorage.getItem('preferredLanguage') || 'ko';

                    // 필요한 데이터 추가
                    // const formData = {
                    //     'order_id': orderData.order_id,
                    //     'productName': orderData.productName,
                    //     'convertedAmount': orderData.price,
                    //     'lang': currentLang  // 언어 정보 추가
                    // };

                    // hidden input 필드 생성
                    // for (const [key, value] of Object.entries(formData)) {
                    //     const input = document.createElement('input');
                    //     input.type = 'hidden';
                    //     input.name = key;
                    //     input.value = value;
                    //     form.appendChild(input);
                    // }

                    // 폼을 body에 추가하고 제출  lee
                    // document.body.appendChild(form);
                    // form.submit();

                    // 카드 폼 초기화 함수 호출
                    initializeCardForm();

                    orderForm.style.display = 'none';

                    const cardPaymentPopup = document.getElementById('cardPaymentPopup');
                    if (cardPaymentPopup) {
                        // 결제 금액 업데이트
                        updatePaymentAmount(BASE_PRICE_KRW);
                        showCardPaymentPopup();
                    }
                    // 카드 결제 팝업 표시 lee
                    // const cardPaymentPopup = document.getElementById('cardPaymentPopup');
                    
                    // if (cardPaymentPopup) {
                    //   cardPaymentPopup.style.display = 'flex';
                    //   // 기존 스타일 초기화 및 새로운 스타일 적용
                    //   // cardPaymentPopup.style.cssText = `
                    //   //     display: flex !important;
                    //   //     position: fixed;
                    //   //     top: 0;
                    //   //     left: 0;
                    //   //     right: 0;
                    //   //     bottom: 0;
                    //   //     background: rgba(0, 0, 0, 0.7);
                    //   //     z-index: 100001;
                    //   //     align-items: center;
                    //   //     justify-content: center;
                    //   // `;
                      
                    //   // 모달 내부 컨텐츠의 z-index 설정
                    //   // const modalContent = cardPaymentPopup.querySelector('.cardinfo-form');
                    //   // if (modalContent) {
                    //   //     modalContent.style.display = 'flex';
                    //   //     modalContent.style.zIndex = '100001';
                    //   // }
                        
                    //   // 배경 스크롤 방지
                    //   // document.body.style.overflow = 'hidden';
                        
                    //   console.log('Popup element:', cardPaymentPopup);
                    //   console.log('Result success:', result.success);
                    // } else {
                    //   console.error('Card payment popup element not found');
                    // }

                    // 결제 금액 업데이트
                    // document.getElementById('paymentAmount').textContent = window.currencyService.formatCurrencyByLanguage(BASE_PRICE_KRW, localStorage.getItem('preferredLanguage') || 'ko');
                 
                  } else {
                    throw new Error(result.message || '주문 처리 중 오류가 발생했습니다.');
                  }

                  // const paymentAmount = document.getElementById('paymentAmount');

                  // 결제 금액 표시 업데이트
                  // if (paymentAmount) {
                  //     // 현재 언어에 맞는 통화 형식으로 금액 표시
                  //     const formattedAmount = window.currencyService.formatCurrencyByLanguage(
                  //         BASE_PRICE_KRW,
                  //         'ko' // 카드결제는 항상 KRW로 처리
                  //     );
                  //     paymentAmount.textContent = formattedAmount;
                  // }

                  // 팝업 표시
                  // if (cardPaymentPopup) {
                  //     cardPaymentPopup.style.display = 'block';
                  //     document.body.style.overflow = 'hidden'; // 배경 스크롤 방지
                  // }

                  // 카드 결제 폼 제출 이벤트 핸들러
                  // const cardInfoForm = document.getElementById('cardInfoForm');
                  // cardInfoForm.addEventListener('submit', async function(e) {
                  //     e.preventDefault();
                  //     if (!validateForm()) return;

                  //     try {
                  //         // 카드 정보를 포함한 결제 데이터 구성
                  //         const formData = new FormData(this);
                  //         formData.append('order_id', orderId);
                  //         formData.append('convertedAmount', BASE_PRICE_KRW);
                  //         formData.append('productName', orderData.productName);

                  //         // cardKeyin_Request.php로 결제 요청
                  //         const paymentResponse = await fetch('cardKeyin_Request.php', {
                  //             method: 'POST',
                  //             body: formData
                  //         });

                  //         const paymentResult = await paymentResponse.json();
                          
                  //         if (paymentResult.success) {
                  //             // 결제 성공
                  //             alert('결제가 성공적으로 완료되었습니다.');
                  //             closeCardPopup();
                  //             window.location.href = 'listing.html'; // 결제 완료 후 리디렉션
                  //         } else {
                  //             throw new Error(paymentResult.message || '결제 처리 중 오류가 발생했습니다.');
                  //         }

                  //     } catch (error) {
                  //         console.error('Payment processing error:', error);
                  //         alert(error.message || '결제 처리 중 오류가 발생했습니다.');
                  //     }
                  // });

                } catch (error) {
                  // console.error('Order submission error:', error);
                  // showError(error.message);
                  // alert(error.message);
                  console.error('주문 처리 중 오류:', error);
                  showError(error.message);
                  // 에러 발생 시 3초 후 listing.html로 리다이렉션
                  // setTimeout(() => {
                  //   window.location.href = 'listing.html';
                  // }, 3000);
                }
              });

              // 카드번호 포맷팅
              // document.getElementById('cardNumber').addEventListener('input', function(e) {
              //     let value = e.target.value.replace(/\D/g, '');
              //     value = value.replace(/(\d{4})(?=\d)/g, '$1 ');
              //     e.target.value = value.trim();
              // });

              // 유효기간 포맷팅
              // document.getElementById('cardExpiry').addEventListener('input', function(e) {
              //     let value = e.target.value.replace(/\D/g, '');
              //     if (value.length >= 2) {
              //         value = value.substr(0,2) + '/' + value.substr(2);
              //     }
              //     e.target.value = value;
              // });

              // 입력값 유효성 검사
              // function validateForm() {
              //     const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
              //     const cardExpiry = document.getElementById('cardExpiry').value;
              //     const authNum = document.getElementById('buyerAuthNum').value;
              //     const cardPwd = document.getElementById('cardPwd').value;

              //     if (cardNumber.length !== 16 || !/^\d+$/.test(cardNumber)) {
              //         alert('올바른 카드번호를 입력해주세요.');
              //         return false;
              //     }

              //     const [month, year] = cardExpiry.split('/');
              //     if (!month || !year || month > 12 || month < 1) {
              //         alert('올바른 유효기간을 입력해주세요.');
              //         return false;
              //     }

              //     if (authNum.length !== 6 && authNum.length !== 10) {
              //         alert('생년월일(6자리) 또는 사업자번호(10자리)를 입력해주세요.');
              //         return false;
              //     }

              //     if (cardPwd.length !== 2 || !/^\d+$/.test(cardPwd)) {
              //         alert('카드 비밀번호 앞 2자리를 입력해주세요.');
              //         return false;
              //     }

              //     return true;
              // }


              


              // 폼 제출 처리
              // document.getElementById('cardInfoForm').addEventListener('submit', async function(e) {
              //   e.preventDefault();
              //   if (!validateForm()) return;
                
              //   // 여기에 결제 처리 로직 추가
              //   try {
              //     const orderFormData = JSON.parse(sessionStorage.getItem('orderFormData'));
                    
              //     // FormData 객체 생성 및 카드 정보 추가
              //     const formData = new FormData(this);
                  
              //     // orderForm 데이터 추가
              //     Object.keys(orderFormData).forEach(key => {
              //       formData.append(key, orderFormData[key]);
              //     });

              //     // 디버깅용 로그
              //     for (let pair of formData.entries()) {
              //       console.log(pair[0] + ': ' + pair[1]);
              //     }

              //     // cardKeyin_Request.php로 데이터 전송
              //     const response = await fetch('cardKeyin_Request.php', {
              //       method: 'POST',
              //       body: formData
              //     });

              //     const result = await response.json();
                  
              //     if (result.success) {
              //       alert('결제가 성공적으로 처리되었습니다.');
              //       // 세션 스토리지 정리
              //       sessionStorage.removeItem('orderFormData');
              //       window.location.href = 'listing.html';
              //     } else {
              //       throw new Error(result.message || '결제 처리 중 오류가 발생했습니다.');
              //     }

              //   } catch (error) {
              //     console.error('Payment error:', error);
              //     alert(error.message || '결제 처리 중 오류가 발생했습니다.');
              //   }
              // });


              // order_form Listener End

              // NicePay 콜백 함수 추가
              // window.nicepaySubmit = function () {
              //   document.payForm.submit();
              // };

              // window.nicepayClose = function () {
              //   alert("결제가 취소되었습니다");
              //   window.location.href = 'listing.html';
              // };

              // contactForm event start here
              contactForm.addEventListener('submit', async function (e) {
                e.preventDefault();
                // console.log('Contact form submission started');
                console.log('Contact form submission started');

                try {
                  // 폼 데이터 로깅
                  console.log('Form data:', {
                    country: this.country.value,
                    name: this.name.value,
                    email: this.email.value,
                    mobile: this.mobile.value
                  });

                  // 파일 업로드 처리
                  const fileData = new FormData();
                  uploadedFiles.forEach((file) => {
                    fileData.append('files[]', file);
                    console.log('Adding file:', file.name);
                  });

                  // 파일 업로드 요청
                  console.log('Sending file upload request');
                  const fileUploadResult = await fetch('upload_file.php', {
                    method: 'POST',
                    body: fileData
                  });

                  if (!fileUploadResult.ok) {
                    throw new Error(`HTTP error! status: ${fileUploadResult.status}`);
                  }

                  const fileResponse = await fileUploadResult.json();
                  console.log('File upload response:', fileResponse);

                  if (!fileResponse.success) {
                    throw new Error(fileResponse.message || '파일 업로드에 실패했습니다.');
                  }


                  // Contact Form 데이터 저장
                  const formData = new FormData(this);
                  formData.append('lang', document.documentElement.lang || 'ko');
                  formData.append('fileInfo', JSON.stringify(fileResponse.files));

                  // FormData 내용 로깅
                  for (let [key, value] of formData.entries()) {
                    console.log('FormData entry:', key, value);
                  }

                  // 폼 데이터 제출
                  console.log('Sending form data');
                  const response = await fetch('contactForm_save.php', {
                    method: 'POST',
                    body: formData
                  });

                  if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                  }

                  const result = await response.json();
                  console.log('Contact form save response:', result);

                  if (!result.success) {
                    throw new Error(result.message || '저장에 실패했습니다.');
                  }

                  // 3) order_form 테이블 업데이트
                  const updateOrderResponse = await fetch('update_order.php', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                      contact_form_id: result.contact_id,  // contactForm_save.php에서 반환된 ID
                      order_id: sessionStorage.getItem('current_order_id')  // orderForm 처리 시 저장된 ID
                    })
                  });

                  const updateResult = await updateOrderResponse.json();
                  if (!updateResult.success) {
                    throw new Error(updateResult.message);
                  }

                  // 성공 처리
                  console.log('Form submission successful');
                  alert('제출이 완료되었습니다.');

                  // 4) 성공 처리
                  alert('문의가 성공적으로 등록되었습니다.');
                  window.location.href = 'listing.html';

                  // 데이터 전달 및 폼 전환
                  transferDataToOrderForm();

                  // Form 표시 전환
                  contactForm.style.display = 'none';
                  orderForm.style.display = 'block';

                  if (result.success) {
                    // OrderForm 표시 및 데이터 전달
                    this.style.display = 'none';
                    const orderForm = document.getElementById('orderForm');
                    orderForm.style.display = 'block';

                    // 데이터 전달
                    document.getElementById('orderName').value = this.name.value;
                    document.getElementById('orderEmail').value = this.email.value;
                    document.getElementById('orderPhone').value = this.mobile.value;
                  } else {
                    throw new Error(result.message);
                  }

                } catch (error) {
                  console.error('Contact form submission error:', error);
                  showError(error.message || '처리 중 오류가 발생했습니다.');
                }
              });
              // contact Form Listener End
            });

            // 현재 언어 설정 가져오기
            const currentLang2 = localStorage.getItem('preferredLanguage') || 'en';
            console.log(`DOMContentLoaded out ->  ${currentLang2}`);


          </script>

          <div class="radius-box frame">
            <div class="dropdown-select">
              <button class="listing-btn  btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2"
                data-bs-toggle="dropdown" aria-expanded="false">
                Patent
              </button>
              <ul class="dropdown-menu listing-select-box" aria-labelledby="dropdownMenuButton2">
                <li>
                  <div class="dropdown-item">Patent</div>
                </li>
                <li>
                  <div class="dropdown-item">Movie Drama Comics</div>
                </li>
                <li>
                  <div class="dropdown-item">Music</div>
                </li>
                <li>
                  <div class="dropdown-item">Dance</div>
                </li>
                <li>
                  <div class="dropdown-item">Franchise</div>
                </li>
                <li>
                  <div class="dropdown-item">Trademark</div>
                </li>
                <li>
                  <div class="dropdown-item">Character</div>
                </li>
              </ul>
            </div>
            <div class="radius-box swiper-container" id="swiperContainer">
              <div class="circle-wrapper">
                <span class="Sphere"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- footer start -->
    <footer class="footer-container">
      <div class="footer-wrapper">
        <div class="footer-logo">
          <span>Let's share the IP, It's IP time</span>
          <img src="assets/images/logo.svg" alt="logo" />
        </div>
        <div class="company-name">주식회사 아이피미디어그룹</div>
        <div class="company-info-grid">
          <span>대표: 이성용</span>
          <span>주소: 서울시 강남구 테헤란로151 1116호</span>
          <span>연락처: 02-2238-4345</span>
          <span>이메일: support@stipvelation.com</span>
          <span>사업자등록번호: 644-86-01439</span>
        </div>
      </div>
    </footer>
    <!-- footer end -->
    <!-- 카드 결제 정보 입력 팝업 lee -->
    <div id="cardPaymentPopup" class="modal-overlay" style="display: none;">
      <div class="cardinfo-modal">
        <!-- 닫기 버튼 추가 -->
        <button type="button" class="close-button" onclick="closeCardPopup()">
          <span class="close-icon">×</span>
        </button>
        <form id="cardInfoForm" class="cardinfo-form" action="cardKeyin_Request.php">
          <div class="cardform-container">
            <h2 class="form-title" data-lang-ko="결제 정보 입력" data-lang-en="Payment Information" 
                data-lang-ja="決済情報入力" data-lang-zh="支付信息输入">결제 정보 입력</h2>

            <!-- 카드 정보 섹션 -->
            <div class="card-info">
              <!-- 카드 구분 체크박스 -->
              <div class="input-group">
                <label class="required">
                  <span data-lang-ko="카드 구분" data-lang-en="Card Type" 
                        data-lang-ja="カード区分" data-lang-zh="卡类型"></span>
                </label>
                <div class="checkbox-group">
                  <label class="custom-checkbox">
                    <input type="radio" id="cardTypePersonal" name="cardType" value="personal" checked>
                    <span class="checkmark" display="none"></span>
                    <span class="checkbox-text" data-lang-ko="개인" data-lang-en="Personal" 
                          data-lang-ja="個人" data-lang-zh="个人"></span>
                  </label>
                  <label class="custom-checkbox">
                    <input type="radio" id="cardTypeBusiness" name="cardType" value="business">
                    <span class="checkmark"></span>
                    <span class="checkbox-text" data-lang-ko="법인" data-lang-en="Business" 
                          data-lang-ja="法人" data-lang-zh="法人"></span>
                  </label>
                </div>
              </div>

              <!-- 카드 번호 입력 -->
              <div class="input-group">
                <label for="cardNumber" class="required">
                  <span data-lang-ko="카드번호" data-lang-en="Card Number" 
                        data-lang-ja="カード番号" data-lang-zh="信用卡号"></span>
                </label>
                <div class="card-input">
                  <input type="text" 
                        id="cardNumber" 
                        name="cardNo"
                        maxlength="19" 
                        required
                        autocomplete="false"
                        pattern="\d*"
                        autocomplete="cc-number"
                        data-lang-ko-placeholder="1234 5678 9012 3456"
                        data-lang-en-placeholder="1234 5678 9012 3456"
                        data-lang-ja-placeholder="1234 5678 9012 3456"
                        data-lang-zh-placeholder="1234 5678 9012 3456" />
                  <div class="card-type-icon"></div>
                </div>
              </div>

              <!-- 유효기간 입력 -->
              <div class="input-group">
                <label for="cardExpiry" class="required">
                  <span data-lang-ko="유효기간" data-lang-en="Expiry Date" 
                        data-lang-ja="有効期限" data-lang-zh="有效期"></span>
                </label>
                <input type="text" 
                      id="cardExpiry" 
                      name="cardExpire"
                      maxlength="5" 
                      required
                      autocomplete="false"
                      pattern="\d{2}/\d{2}"
                      autocomplete="cc-exp"
                      placeholder="MM/YY" />
              </div>
            </div>

            <!-- 인증 정보 섹션 -->
            <div class="auth-info">
              <div class="input-group">
                <label for="buyerAuthNum" class="required">
                  <span data-lang-ko="생년월일/사업자번호" data-lang-en="Birth Date/Business Number" 
                        data-lang-ja="生年月日/事業者番号" data-lang-zh="出生日期/营业执照号"></span>
                  <small class="help-text" data-lang-ko="(생년월일 6자리 또는 사업자번호 10자리)"
                        data-lang-en="(6 digits for birth date or 10 digits for business)"
                        data-lang-ja="(生年月日6桁または事業者番号10桁)"
                        data-lang-zh="(出生日期6位或营业执照号10位)"></small>
                </label>
                <input type="text" 
                      id="buyerAuthNum" 
                      name="buyerAuthNum"
                      maxlength="10" 
                      required
                      autocomplete="new-password"
                      pattern="\d*"
                      inputmode="numeric" />
              </div>

              <div class="input-group">
                <label for="cardPwd" class="required">
                  <span data-lang-ko="비밀번호" data-lang-en="Password" 
                        data-lang-ja="パスワード" data-lang-zh="密码"></span>
                  <small class="help-text" data-lang-ko="(앞 2자리)"
                        data-lang-en="(First 2 digits)"
                        data-lang-ja="(最初の2桁)"
                        data-lang-zh="(前2位)"></small>
                </label>
                <div class="password-input">
                  <input type="password" 
                        id="cardPwd" 
                        name="cardPwd"
                        maxlength="2" 
                        required
                        autocomplete="new-password"
                        pattern="\d{2}"
                        inputmode="numeric" />
                </div>
                <div class="input-group">
                  <label for="buyerEmail" class="required">
                    <span data-lang-ko="이메일" data-lang-en="Email" 
                          data-lang-ja="メール" data-lang-zh="电子邮件"></span>
                  </label>
                  <input type="email" 
                        id="buyerEmail" 
                        name="buyerEmail"
                        required
                        autocomplete="false" />
                </div>
                <div style="display: none;">
                  <input type="text" id="hidden_input" readonly />
                </div>
              </div>
            </div>

            <!-- 결제 금액 표시 -->
            <div class="payment-summary">
              <span class="amount-label" data-lang-ko="결제 금액" data-lang-en="Amount" 
                    data-lang-ja="決済金額" data-lang-zh="支付金额"></span>
              <span class="amount" id="paymentAmount">99,000 KRW</span>
            </div>

            <!-- 버튼 그룹 수정 -->
            <div class="button-group">
              <button type="submit" class="normal-button">
                <span data-lang-ko="결제하기" data-lang-en="Pay Now" 
                      data-lang-ja="決済する" data-lang-zh="立即支付">결제하기</span>
              </button>
              <button type="button" class="normal-button cancel" onclick="closeCardPopup()">
                <span data-lang-ko="취소" data-lang-en="Cancel" 
                      data-lang-ja="キャンセル" data-lang-zh="取消">취소</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div> 
  </div>
  <style>
/* 카드 결제 모달 애니메이션 및 위치 스타일 */
#cardPaymentPopup {
  position: fixed;
  top: 0;
  right: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: none;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}

#cardPaymentPopup.active {
  display: block;
  opacity: 1;
}

.cardinfo-modal {
  position: absolute;
  top: 0;
  right: -440px; /* 초기 위치: 화면 밖 */
  width: 440px;
  height: 100%;
  background: #1a1a1a;
  border-radius: 12px 0 0 12px;
  overflow-y: auto;
  transition: right 0.3s ease-in-out;
}

#cardPaymentPopup.active .cardinfo-modal {
  right: 0; /* 활성화 시 오른쪽으로 이동 */
}

.cardform-container {
  padding: 24px;
  min-height: 100%;
  display: flex;
  flex-direction: column;
}

#cardInfoForm {
  height: 100%;
}

.form-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin-bottom: 24px;
  color: #fcfcfc;
}

.card-info,
.auth-info {
  margin-bottom: 6px;
}

.input-group {
  margin-bottom: 6px;
}

.input-group label {
  display: block;
  margin-bottom: 8px;
  color: #fcfcfc;
}

.input-group input {
  width: 100%;
  padding: 12px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  color: #fcfcfc;
}

/* .payment-summary {
  margin-top: auto;
  padding: 4px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  margin-bottom: 4px;
} */

.button-group {
  display: flex;
  gap: 12px;
}

/* 모바일 대응 */
@media (max-width: 480px) {
  .cardinfo-modal {
    width: 100%;
    border-radius: 0;
  }
  
  .button-group {
    flex-direction: column;
  }
}

@media (max-width: 480px) {
    .cardinfo-modal {
        width: 100%;
        right: -100%; /* 모바일에서는 전체 너비만큼 밖으로 */
        border-radius: 0;
    }
    
    .cardform-container {
        padding: 16px;
    }
    
    .button-group {
        flex-direction: column;
        padding-bottom: 20px;
    }
}

/* 결제 금액 표시 영역 스타일 */
.payment-summary {
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-radius: 8px;
  margin: 4px 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.amount-label {
  color: #fcfcfc;
  font-size: 16px;
}

#paymentAmount {
  color: #fcfcfc;
  font-size: 18px;
  font-weight: 600;
}

/* 금액 강조 스타일 */
.amount {
  color: #fcfcfc;
  font-size: 18px;
  font-weight: 600;
  text-align: right;
}

/* 닫기 버튼 스타일 */
.close-button {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: #000;
  border: 2px solid rgba(255, 255, 255, 0.8);
  color: #fff;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  z-index: 10001;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.close-button:hover {
  transform: rotate(90deg);
  border-color: #fff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.close-icon {
  font-size: 24px;
  font-weight: bold;
  line-height: 1;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

/* 버튼 그룹 수정 */
.button-group {
  display: flex;
  gap: 12px;
  margin-top: 4px;
}

.button-group .normal-button {
  flex: 1;
  min-height: 48px;
  background-color: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: #fcfcfc;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  transition: all 0.3s ease;
  backdrop-filter: blur(5px);
  display: flex;
  align-items: center;
  justify-content: center;
}

.button-group .normal-button:hover {
  background-color: rgba(0, 0, 0, 0.5);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.button-group .normal-button:active {
  transform: translateY(0);
}

/* 모바일 대응 */
@media (max-width: 480px) {
  .close-button {
    top: 20px;
    left: 20px;
    background-color: transparent;
    border: none;
    box-shadow: none;
  }

  .button-group {
    flex-direction: column;
    padding: 0 16px 20px;
  }

  .button-group .normal-button {
    width: 100%;
  }
}

/* 체크박스 그룹 스타일 */
.checkbox-group {
    display: flex;
    align-items: center;
    gap: 20px; /* 체크박스 사이 간격 */
}

/* 커스텀 체크박스 컨테이너 */
.custom-checkbox {
    display: flex;
    align-items: center;
    position: relative;
    cursor: pointer;
    padding-left: 28px; /* 체크마크 공간 확보 */
    user-select: none;
}

/* 기본 체크박스 숨기기 */
/* .custom-checkbox input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
} */

/* 기본 체크박스 완전히 숨기기 */
.custom-checkbox input {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    width: 0;
    height: 0;
    margin: 0;
    padding: 0;
}

/* 커스텀 체크마크 스타일 */
.checkmark {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    height: 20px;
    width: 20px;
    border: 2px solid #ddd;
    border-radius: 50%; /* 원형 모양 */
    transition: all 0.2s ease;
}

/* 체크박스 호버 효과 */
.custom-checkbox:hover input ~ .checkmark {
    border-color: #ccc;
}

/* 선택된 체크마크 스타일 */
.custom-checkbox input:checked ~ .checkmark {
    background-color: #fff;
    border-color: #4CAF50; /* 초록색 테두리 */
}

/* 선택된 체크마크 안의 원 */
.checkmark:after {
    content: "";
    position: absolute;
    display: none;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #4CAF50; /* 초록색 */
}

/* 체크박스 선택 시 내부 원 표시 */
.custom-checkbox input:checked ~ .checkmark:after {
    display: block;
}

/* 체크박스 텍스트 스타일 */
.checkbox-text {
    margin-left: 8px;
    font-size: 14px;
    color: #fff;
}
  </style>
  <script>
    // 전역 변수 선언
    window.tagCloud = null;
    const cloudContainer = document.querySelector(".Sphere");
    const tagElements = cloudContainer.querySelectorAll(".tagcloud--item");
    const dropdownSelect = document.querySelector('.dropdown-select');
    const circleWrapper = document.querySelector('.circle-wrapper');
    const radius = Math.max(
      170,
      Math.min(280, window.innerWidth - window.innerWidth * 0.95)
    );

    // 카드 결제 관련 함수들
    function initializeCardForm() {
      const cardForm = document.getElementById('cardInfoForm');
      const cardNumber = document.getElementById('cardNumber');
      const cardExpiry = document.getElementById('cardExpiry');
      const buyerAuthNum = document.getElementById('buyerAuthNum');
      const buyerTypeRadios = document.getElementsByName('buyerType');
      const cardPwd = document.getElementById('cardPwd');
      const buyerEmail = document.getElementById('buyerEmail');

      if (!cardForm) return; // 폼이 존재하지 않으면 실행하지 않음


      // 체크박스 상호 배타적 선택 처리
      function handleCheckboxChange(radioBox, otherBox) {
          // if (radioBox.checked) {
          //     otherBox.checked = false;
          // } else if (!otherBox.checked) {
          //     // 둘 다 체크 해제되는 것 방지
          //     radioBox.checked = true;
          // }
          updateAuthNumField();
      }

      // 체크박스 이벤트 리스너
      cardTypePersonal?.addEventListener('change', function() {
          handleCheckboxChange(cardTypePersonal, cardTypeBusiness);
      });

      cardTypeBusiness?.addEventListener('change', function() {
          handleCheckboxChange(cardTypeBusiness, cardTypePersonal);
      });

      // 생년월일/사업자번호 필드 업데이트 함수
      function updateAuthNumField() {
          if (buyerAuthNum) {
              buyerAuthNum.value = ''; // 값 초기화
              
              // 라벨과 도움말 텍스트 변경
              const label = buyerAuthNum.previousElementSibling;
              const helpText = label.querySelector('.help-text');
              
              if (cardTypePersonal.checked) {
                  label.querySelector('span').textContent = '생년월일';
                  helpText.textContent = '(생년월일 6자리)';
                  buyerAuthNum.placeholder = '예: 901231';
                  buyerAuthNum.maxLength = 6;
              } else {
                  label.querySelector('span').textContent = '사업자번호';
                  helpText.textContent = '(사업자번호 10자리)';
                  buyerAuthNum.placeholder = '예: 123-45-67890';
                  buyerAuthNum.maxLength = 12;
              }
          }
      }

      // 초기 필드 상태 설정
      updateAuthNumField();

      // 카드 번호 포맷팅
      cardNumber?.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          let formattedValue = '';
          
          for (let i = 0; i < value.length && i < 16; i++) {
              if (i > 0 && i % 4 === 0) {
                  formattedValue += ' ';
              }
              formattedValue += value[i];
          }
          
          e.target.value = formattedValue;
          // console.log(`${formattedValue}`);
      });

      // 카드 번호 포맷팅
      // cardNumber?.addEventListener('input', function(e) {
      //     let value = e.target.value.replace(/\D/g, '');
      //     let formattedValue = '';
          
      //     for (let i = 0; i < value.length && i < 16; i++) {
      //         if (i > 0 && i % 4 === 0) {
      //             formattedValue += ' ';
      //         }
      //         formattedValue += value[i];
      //     }
          
      //     e.target.value = formattedValue;
      // });

      // 카드 유효기간 포맷팅
      cardExpiry?.addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');
          
          if (value.length > 0) {
              let month = value.substring(0, 2);
              let year = value.substring(2, 4);
              
              if (month.length === 2) {
                  month = Math.min(Math.max(parseInt(month), 1), 12).toString().padStart(2, '0');
              }
              
              if (value.length > 2) {
                  e.target.value = `${month}/${year}`;
              } else {
                  e.target.value = month;
              }
          }
      });

      // 생년월일/사업자번호 포맷팅
      buyerAuthNum?.addEventListener('input', function(e) {
          // const isPersonal = document.querySelector('input[name="buyerType"]:checked').value ;
          let cardType = '';
          let value = e.target.value.replace(/\D/g, '');
          if (document.getElementById('cardTypePersonal').checked) {
            cardType = 'personal';
          } else if (document.getElementById('cardTypeBusiness').checked) {
            cardType = 'business';
          }
          
          if (cardType === 'personal') {
              e.target.value = value.substring(0, 6);
              e.target.maxLength = 6;
          } else {
              let formattedValue = '';
              if (value.length > 0) {
                  formattedValue = value.substring(0, 3);
                  if (value.length > 3) {
                      formattedValue += '-' + value.substring(3, 5);
                  }
                  if (value.length > 5) {
                      formattedValue += '-' + value.substring(5, 10);
                  }
              }
              e.target.value = formattedValue;
              e.target.maxLength = 12;
          }
      });

      // 라디오 버튼과 인증 번호 필드 가져오기
      // const buyerTypeRadios = document.querySelectorAll('input[name="cardType"]');
      // const buyerAuthNum = document.getElementById('buyerAuthNum');
      // 사업자 구분 변경 이벤트
      buyerTypeRadios.forEach(radio => {
        console.log('선택된 카드 타입:', radio[0].checked ? '개인' : '법인'); // 선택된 값 출력
        radio?.addEventListener('change', () => {
            // if (buyerAuthNum) buyerAuthNum.value = '';
            if (buyerAuthNum) {
                buyerAuthNum.value = ''; // 인증 번호 필드 초기화
            }
            
        });
      });

      // 폼 제출 이벤트
      cardForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!validateCardForm()) return;

        const formData = new FormData(form);
        // 카드 종류 선택 처리 (체크박스 처리 로직)
        let cardType = '';
        if (document.getElementById('cardTypePersonal').checked) {
          cardType = 'personal';
        } else if (document.getElementById('cardTypeBusiness').checked) {
          cardType = 'business';
        }

        
        const cardformData = {
          order_id: orderId,              // 생성된 order_id 추가
          productCode: document.getElementById('hidden_orderProductCode').value,
          productName: document.getElementById('hidden_orderProductName').value,
          quantity: document.getElementById('hidden_orderQuantity').value,
          price: BASE_PRICE_KRW,
          currency: currencyInfo.currency
        };

        console.log('Sending CardInfo data:', cardformData);

        // const cardForm = document.getElementById('cardInfoForm');
        // const cardNumber = document.getElementById('cardNumber');
        // const cardExpiry = document.getElementById('cardExpiry');
        // const buyerAuthNum = document.getElementById('buyerAuthNum');
        // const buyerTypeRadios = document.getElementsByName('buyerType');
        // const cardPwd = document.getElementById('cardPwd');
        // const email = document.getElementById('email');

        formData.set('cardType', buyerTypeRadios[0].checked ? 'personal' : 'business');
        formData.set('cardNumber', cardNumber);
        formData.set('cardExpiry', cardExpiry);
        formData.set('buyerAuthNum', buyerAuthNum);
        formData.set('cardPwd', cardPwd);
        formData.set('buyerEmail', buyerEmail);
        formData.set('order_id', orderId);
        formData.set('productCode', document.getElementById('hidden_orderProductCode').value);
        formData.set('productName', document.getElementById('hidden_orderProductName').value);
        formData.set('quantity', document.getElementById('hidden_orderQuantity').value);
        formData.set('price', BASE_PRICE_KRW);
        formData.set('currency', currencyInfo.currency);
        
        fetch(form.action, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        })
        .then(response => {
          if (!response.ok) {  // 응답 코드가 200-299 범위를 벗어난 경우
            throw new Error(`HTTP error! status: ${response.status}`); // 명시적으로 에러 발생
          }
          return response.json(); // 성공적인 응답 처리
        })
        .then(result => {
            if (result.success) {
              // 결제 성공 로직
                alert("결제가 성공적으로 완료되었습니다.");
                window.location.href = "listing.html"; //  결제 완료 페이지 URL
            } else {
              // 결제 실패 로직
              console.error("결제 실패:", result.message);
                alert("결제에 실패했습니다. 다시 시도해주세요.");
            }
        })
        .catch(error => {
          console.error("결제 요청 또는 응답 처리 중 오류 발생:", error);
          alert("결제 처리 중 오류가 발생했습니다.");
        });

        
        // 여기에 실제 폼 제출 로직 추가
        // cardKeyin_Request.php 
        // $goodsName = '';
        // $price = 0;
        

        // console.log('Sending preview data:', cardformData);

        // const saveResponse = await fetch('cardKeyin_Request.php', {
        //   method: 'POST',
        //   headers: {
        //     'Content-Type': 'application/json',
        //   },
        //   body: JSON.stringify(cardformData)
        // });

        if (!saveResponse.ok) {
          throw new Error('Failed to result NicePay');
        }
        console.log('폼 검증 완료, 제출 진행');
      });
    }

    // 폼 유효성 검사 함수
    function validateCardForm() {
        const cardNumber = document.getElementById('cardNumber');
        const cardExpiry = document.getElementById('cardExpiry');
        const buyerAuthNum = document.getElementById('buyerAuthNum');
        const buyerEmail = document.getElementById('buyerEmail');

        // 카드번호 검사
        const cardNumberValue = cardNumber.value.replace(/\s/g, '');
        console.log(`${carNumValue}`);
        if (cardNumberValue.length !== 16) {
            alert('올바른 카드번호를 입력해주세요.');
            cardNumber.focus();
            return false;
        }

        // 유효기간 검사
        if (!/^\d{2}\/\d{2}$/.test(cardExpiry.value)) {
            alert('올바른 유효기간을 입력해주세요.');
            cardExpiry.focus();
            return false;
        }

        // 생년월일/사업자번호 검사
        const isPersonal = document.querySelector('input[name="buyerType"]:checked').value;
        const authNumValue = buyerAuthNum.value.replace(/\D/g, '');
        if (isPersonal === 'personal' && authNumValue.length !== 6) {
            alert('올바른 생년월일을 입력해주세요.');
            buyerAuthNum.focus();
            return false;
        } else if (!isPersonal && authNumValue.length !== 10) {
            alert('올바른 사업자번호를 입력해주세요.');
            buyerAuthNum.focus();
            return false;
        }

        // 이메일 검사
        if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(buyerEmail.value)) {
            alert('올바른 이메일 주소를 입력해주세요.');
            buyerEmail = '';
            buyerEmail.focus();
            return false;
        }

        return true;
    }

    // 결제 금액 업데이트 함수
    function updatePaymentAmount(amount) {
        const paymentAmount = document.getElementById('paymentAmount');
        if (paymentAmount) {
            // 현재 언어에 맞는 통화 형식으로 금액 표시
            const currentLang = localStorage.getItem('preferredLanguage') || 'ko';
            const formattedAmount = window.currencyService.formatCurrencyByLanguage(
                amount,
                currentLang
            );
            paymentAmount.textContent = formattedAmount;
        }
    }
                  // 카드 결제 폼 표시 함수
    function showCardPaymentPopup() {
        const popup = document.getElementById('cardPaymentPopup');
        if (popup) {
            popup.style.display = 'block';
            // 강제 리플로우 발생
            popup.offsetHeight;
            popup.classList.add('active');
            document.body.style.overflow = 'hidden'; // 배경 스크롤 방지
        }
    }

    function closeCardPopup() {
        const popup = document.getElementById('cardPaymentPopup');
        if (popup) {
            popup.classList.remove('active');
            // 애니메이션 완료 후 처리
            setTimeout(() => {
                popup.style.display = 'none';
                document.body.style.overflow = 'auto';
                // listing.html 페이지로 이동
                window.location.href = 'listing.html';
            }, 300);
        }
    }

    dropdownSelect.addEventListener('click', (event) => {
      let divValue = null;

      const liElement = event.target.closest('li');
      if (liElement) {
        const divElement = liElement.querySelector('div');
        if (divElement) {
          divValue = divElement.textContent.trim();
        }
      }
      const listingBtn = document.querySelector('.listing-btn');

      if (listingBtn && divValue) {
        const frameBox = document.querySelector('.frame');
        const squareBox = document.querySelector('.Sphere');

        //라이프 사이클 문제로 삭제
          // if (!window.tagCloud) {
          //   window.tagCloud = TagCloud(".Sphere", window.tagCloudService.tagCloudImages['Patent'], {
          //     radius,
          //     maxSpeed: "normal",
          //     initSpeed: "normal",
          //     direction: 205,
          //     keep: true,
          //     useHTML: true,
          //   });
          // }
          singleSwiperWrapper.style.display = "none";
          swiperWrapper.style.display = "none";
          circleWrapper.style.display = "flex";
          if (window.innerWidth < 768) {
            const padding = 64;
            frameBox.style.height = squareBox.clientHeight + padding + "px";
          }
          window.tagCloud.resume();
          window.tagCloud.update(window.tagCloudService.tagCloudImages[divValue]);
        listingBtn.textContent = divValue;
      }

      const debouncedFunction = window.deviceService.debounce(() => {
        // 실행할 코드
        handleDropdownClick(event);
      }, 300); // 300ms 대기 시간
    });

    // 드롭다운 선택 시 태그 클라우드 업데이트
    if (dropdownSelect) {
      dropdownSelect.addEventListener('click', (event) => {
        const liElement = event.target.closest('li');
        if (liElement) {
          const divElement = liElement.querySelector('div');
          if (divElement) {
            const category = divElement.textContent.trim();
            if (window.tagCloudService) {
                window.tagCloudService.updateCategory(category);
              }
          }
        }
      });
    }

  </script>
  <!-- <script src="components/header.js" defer></script> -->
  <!-- 환율 API 키 -->

  <script src="js/updated-language-script.js"></script>
  <script src="js/loading-service.js"></script>
  <script src="js/toast-service.js"></script>
  <!-- <script src="js/payment-handler3.js"></script> -->

  <!-- 새로 추가된 스크립트들 -->
  <!-- <script src="js/file-uploader.js"></script> -->
  <!-- <script src="payment-handler.js"></script> -->
  <!-- <script src="form-handler.js"></script> -->

  <!-- body 끝부분에 추가 -->
  <div class="loading-overlay">
    <div class="loading-spinner"></div>
  </div>
</body>

</html>